<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volty PRO - Advanced Trading Bot</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/000000/stocks-growth.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #8b5cf6;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --background-dark: #0c1426;
            --background-medium: #1a1a2e;
            --background-light: #16213e;
            --text-light: #f1f5f9;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.1);
            --input-disabled-bg: rgba(100, 100, 100, 0.2);
            --input-disabled-text: rgba(255, 255, 255, 0.6);
        }
        
        body {
            background: linear-gradient(135deg, var(--background-dark) 0%, var(--background-medium) 50%, var(--background-light) 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .gradient-header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            text-align: center;
            margin: 1.5rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .pro-badge {
            background: linear-gradient(90deg, #f43f5e, #ec4899);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
            position: relative;
            top: -15px;
            left: 5px;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            backdrop-filter: blur(10px);
            text-align: center;
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .metric-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .metric-delta {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .sidebar {
            background: var(--background-medium);
            border-right: 1px solid var(--card-border);
            padding: 1.5rem;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            width: 280px;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        /* Update main content area to match */
        .main-content {
            margin-left: 280px;
            padding: 0 20px;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 33.33%;
            }
            
            .main-content {
                margin-left: 33.33%;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: static;
                height: auto;
                width: 100%;
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        .status-indicator {
            display: inline-block;
            background-color: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .status-indicator.live {
            background-color: #dc2626;
            animation: pulse 2s infinite;
        }

        .status-indicator.active {
            background-color: var(--success-color);
            animation: pulse 2s infinite;
        }

        .status-indicator.idle {
            background-color: #f59e0b;
        }

        .status-indicator.real-money {
            background-color: #be123c;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
            100% {
                opacity: 1;
            }
        }
        
        /* Form controls - ensuring text is visible even when disabled */
        .form-control, .form-select {
            background-color: var(--input-bg);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            border-radius: 6px;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-color);
            color: var(--text-light);
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.25);
        }
        
        /* Fix for disabled inputs - ensure text is visible */
        .form-control:disabled, .form-select:disabled {
            background-color: var(--input-disabled-bg);
            color: var(--input-disabled-text);
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Fix for placeholder text in disabled inputs */
        .form-control:disabled::placeholder {
            color: var(--input-disabled-text);
            opacity: 0.7;
        }
        
        /* Fix for input group text */
        .input-group-text {
            background-color: rgba(70, 70, 100, 0.3);
            color: var(--text-light);
            border: 1px solid var(--card-border);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-real-money {
            background: linear-gradient(90deg, #be123c, #f43f5e);
            border: none;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-real-money:hover {
            background: linear-gradient(90deg, #f43f5e, #be123c);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-buy {
            background: linear-gradient(90deg, #059669, #10b981);
            border: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-buy:hover {
            background: linear-gradient(90deg, #10b981, #059669);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-sell {
            background: linear-gradient(90deg, #dc2626, #ef4444);
            border: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-sell:hover {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .trade-long {
            background-color: rgba(34, 197, 94, 0.1);
            border-left: 4px solid var(--success-color);
        }
        
        .trade-short {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--danger-color);
        }
        
        .tab-content {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 0 0 10px 10px;
            padding: 1rem;
        }
        
        .nav-tabs {
            border-bottom: 1px solid var(--card-border);
        }
        
        .nav-tabs .nav-link {
            color: var(--text-light);
            border: none;
            border-radius: 8px 8px 0 0;
            margin-right: 2px;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 1px solid var(--card-border);
            border-bottom: none;
        }
        
        table.trade-history {
            width: 100%;
            border-collapse: collapse;
        }
        
        .trade-history th, .trade-history td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }
        
        .trade-history th {
            font-weight: 600;
            opacity: 0.8;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        .trade-history tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .positive {
            color: var(--success-color);
        }
        
        .negative {
            color: var(--danger-color);
        }

        #priceChart, #equityChart {
            width: 100%;
            height: 100%;
        }
        
        .loading-indicator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .form-switch .form-check-input {
            width: 2.5em;
            height: 1.25em;
            margin-left: -3em;
        }
        
        .form-switch .form-check-input:checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .mobile-info {
            background-color: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger-color);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        /* Light theme overrides */
        body.light-theme {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            color: #334155;
        }
        
        .light-theme .card, 
        .light-theme .metric-card {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(203, 213, 225, 0.5);
        }
        
        .light-theme .sidebar {
            background: rgba(255, 255, 255, 0.8);
            border-right: 1px solid rgba(203, 213, 225, 0.5);
        }
        
        .light-theme .form-control, 
        .light-theme .form-select {
            background-color: rgba(255, 255, 255, 0.8);
            color: #334155;
            border: 1px solid rgba(203, 213, 225, 0.5);
        }
        
        .light-theme .form-control:disabled, 
        .light-theme .form-select:disabled {
            background-color: rgba(200, 200, 200, 0.5);
            color: #555555;
        }
        
        .light-theme .input-group-text {
            background-color: rgba(200, 200, 220, 0.5);
            color: #334155;
            border: 1px solid rgba(203, 213, 225, 0.5);
        }
        
        /* Toggle switch styling */
        .form-check-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Alert styling */
        .alert {
            background-color: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: var(--text-light);
            border-radius: 8px;
        }
        
        .light-theme .alert {
            color: #334155;
        }

        /* Clock and date display */
        .clock-display {
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--card-border);
            letter-spacing: 0.5px;
        }

        /* Bot activity indicator */
        .bot-activity {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .bot-activity.scanning {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .bot-activity.trading {
            background-color: rgba(34, 197, 94, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .bot-activity.waiting {
            background-color: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
        }

        .bot-activity.real-money {
            background-color: rgba(190, 18, 60, 0.1);
            border-left: 4px solid #be123c;
        }

        /* Last tick information */
        .last-tick-info {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            opacity: 0.8;
        }

        /* Statistics panel */
        .stats-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .stat-item {
            flex: 1;
            min-width: 100px;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* Real-time market data section */
        .market-data {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .market-data-item {
            flex: 1;
            min-width: 110px;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .market-data-item:hover {
            transform: translateY(-2px);
        }

        .market-label {
            font-size: 0.7rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .market-value {
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 4px;
        }

        .up {
            color: var(--success-color);
        }

        .down {
            color: var(--danger-color);
        }

        /* API Key section */
        .api-key-form {
            margin-top: 1rem;
            padding: 1.25rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .api-key-mask {
            font-family: monospace;
            letter-spacing: 2px;
        }
        
        .api-key-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }
        
        .api-key-status.valid {
            background-color: rgba(34, 197, 94, 0.2);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        
        .api-key-status.invalid {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
        
        .api-key-status.pending {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }
        
        /* Real money warning */
        .real-money-warning {
            background-color: rgba(190, 18, 60, 0.1);
            border: 1px solid #be123c;
            border-radius: 10px;
            padding: 1.25rem;
            margin: 1.25rem 0;
            animation: warning-pulse 2s infinite;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes warning-pulse {
            0% {
                background-color: rgba(190, 18, 60, 0.1);
            }
            50% {
                background-color: rgba(190, 18, 60, 0.2);
            }
            100% {
                background-color: rgba(190, 18, 60, 0.1);
            }
        }
        
        /* Balance section */
        .balance-section {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1.25rem;
            margin-top: 1.25rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .balance-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .balance-item:last-child {
            border-bottom: none;
        }
        
        .balance-value {
            font-weight: bold;
        }
        
        /* Mode switching icons */
        .mode-icons {
            display: flex;
            justify-content: center;
            gap: 2.5rem;
            margin: 1.25rem 0;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mode-icon-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .mode-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background-color: rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .mode-icon:hover {
            transform: scale(1.1);
        }
        
        .mode-icon.paper {
            color: var(--primary-color);
        }
        
        .mode-icon.real {
            color: #f43f5e;
        }
        
        .mode-icon.active {
            border-color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        
        .mode-label {
            margin-top: 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        /* User panel in sidebar */
        .user-panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            margin-bottom: 1.25rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .user-name {
            font-size: 1rem;
            font-weight: 500;
        }
        
        .logout-btn {
            background: none;
            border: none;
            color: var(--text-light);
            opacity: 0.7;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .logout-btn:hover {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Emergency control */
        .emergency-control {
            margin-top: 1.25rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 0, 0, 0.3);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .emergency-trading-notice {
            font-size: 0.8rem;
            padding: 0.5rem;
            text-align: center;
            margin-bottom: 0.75rem !important;
            animation: pulse-warning 2s infinite;
            border-radius: 6px;
        }

        @keyframes pulse-warning {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        /* Chart controls */
        .chart-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .chart-control-button {
            padding: 0.5rem 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .chart-control-button:hover {
            background-color: rgba(0, 0, 0, 0.3);
            transform: translateY(-1px);
        }
        
        /* Export controls */
        .export-controls {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
        }
        
        .export-button {
            flex: 1;
            padding: 0.75rem;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .export-button:hover {
            background-color: rgba(0, 0, 0, 0.3);
            transform: translateY(-1px);
        }
        
        /* Settings sections */
        .settings-section {
            margin-bottom: 1.5rem;
        }
        
        .settings-section h6 {
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 0.75rem;
            margin-bottom: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        /* Chart tools */
        .chart-tools {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            gap: 0.5rem;
        }
        
        .chart-tool-button {
            width: 36px;
            height: 36px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .chart-tool-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
            transform: scale(1.1);
        }
        
        /* Sidebar Tab Styling */
        .sidebar-tabs {
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .sidebar-tabs .nav-link {
            color: var(--text-light);
            padding: 0.75rem 0.5rem;
            font-size: 0.9rem;
            border-radius: 0;
            font-weight: 500;
        }

        .sidebar-tabs .nav-link.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
        }

        .sidebar-tabs .nav-link i {
            margin-right: 6px;
        }
        
        /* Login modal styling */
        .modal-content {
            background-color: var(--background-medium);
            color: var(--text-light);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            border-bottom: 1px solid var(--card-border);
            background: linear-gradient(90deg, var(--background-dark), var(--background-medium));
            padding: 1.25rem 1.5rem;
            border-radius: 12px 12px 0 0;
        }
        
        .modal-footer {
            border-top: 1px solid var(--card-border);
            background: linear-gradient(90deg, var(--background-medium), var(--background-dark));
            padding: 1.25rem 1.5rem;
            border-radius: 0 0 12px 12px;
        }
        
        /* Fix for input fields */
        .form-control.login-field {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 0.75rem 1rem;
        }
        
        .form-control.login-field:focus {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border-color: var(--primary-color);
        }

        /* Settings tab styling */
        .settings-card {
            margin-bottom: 1.5rem;
            padding: 1.25rem;
        }

        .settings-card h5 {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .settings-group {
            margin-bottom: 1.25rem;
        }

        .settings-group .form-label {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .settings-actions {
            margin-top: 1.5rem;
            text-align: right;
        }

        /* Network status indicator */
        .network-status {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            background-color: rgba(0, 0, 0, 0.2);
            margin: 1rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        
        .network-status:hover {
            transform: translateY(-2px);
        }

        .network-status.online {
            border-left: 4px solid var(--success-color);
        }

        .network-status.offline {
            border-left: 4px solid var(--danger-color);
        }

        .network-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .network-status-dot.online {
            background-color: var(--success-color);
        }

        .network-status-dot.offline {
            background-color: var(--danger-color);
        }

        /* Test connection button */
        .test-connection-btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 4px;
        }
        
        /* Discord notification improvements */
        .discord-settings {
            background-color: rgba(88, 101, 242, 0.1);
            border: 1px solid rgba(88, 101, 242, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .discord-preview {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .discord-message {
            background-color: #36393f;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .discord-embed {
            border-left: 4px solid #5865F2;
            background-color: #2f3136;
            border-radius: 0 4px 4px 0;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .discord-title {
            font-weight: bold;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .discord-content {
            color: #dcddde;
            font-size: 0.9rem;
        }
        
        .discord-field {
            margin-top: 0.5rem;
            display: flex;
        }
        
        .discord-field-name {
            font-weight: bold;
            color: white;
            width: 120px;
        }
        
        .discord-field-value {
            color: #dcddde;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
    </div>
    
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">🔒 Authentication Required</h5>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="login-username" class="form-label">Username</label>
                        <input type="text" class="form-control login-field" id="login-username" value="gelimorto2" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="login-password" class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" class="form-control login-field" id="login-password" placeholder="Enter your password">
                            <button class="btn btn-outline-secondary" type="button" id="toggle-password-btn">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-text text-warning" id="login-hint">Hint: Use the default password "trading2025"</div>
                    </div>
                    <div class="alert alert-danger" id="login-error" style="display: none;">
                        Incorrect password. Please try again.
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="remember-login">
                        <label class="form-check-label" for="remember-login">
                            Remember me for 30 days
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="login-submit-btn">Login</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Live Clock Display -->
                <div class="clock-display" id="clock-display">
                    2025-06-07 00:13:54 UTC
                </div>
                
                <div class="user-panel">
                    <div class="user-info">
                        <div class="user-avatar">G</div>
                        <div class="user-name" id="user-login">gelimorto2</div>
                    </div>
                    <button class="logout-btn" id="logout-btn" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                
                <!-- Sidebar Navigation Tabs -->
                <ul class="nav nav-pills nav-fill sidebar-tabs mb-3" id="sidebarTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="main-controls-tab" data-bs-toggle="tab" data-bs-target="#main-controls" type="button" role="tab" aria-controls="main-controls" aria-selected="true">
                            <i class="fas fa-cogs"></i> Main
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="strategy-tab" data-bs-toggle="tab" data-bs-target="#strategy-settings" type="button" role="tab" aria-controls="strategy-settings" aria-selected="false">
                            <i class="fas fa-chart-line"></i> Strategy
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="trading-tab" data-bs-toggle="tab" data-bs-target="#trading-settings" type="button" role="tab" aria-controls="trading-settings" aria-selected="false">
                            <i class="fas fa-dollar-sign"></i> Trading
                        </button>
                    </li>
                </ul>

                <!-- Sidebar Tab Content -->
                <div class="tab-content" id="sidebarTabContent">
                    <!-- Main Controls Tab -->
                    <div class="tab-pane fade show active" id="main-controls" role="tabpanel" aria-labelledby="main-controls-tab">
                        <!-- Mode icons, status, start/stop buttons, etc -->
                        <div class="mode-icons">
                            <div class="mode-icon-wrapper">
                                <div class="mode-icon paper active" id="paper-trading-icon" title="Paper Trading Mode">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <span class="mode-label">Paper</span>
                            </div>
                            
                            <div class="mode-icon-wrapper">
                                <div class="mode-icon real" id="real-trading-icon" title="Real Money Trading Mode">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <span class="mode-label">Real</span>
                            </div>
                        </div>
                        
                        <div class="status-indicator live" id="bot-status">
                            🔴 PAPER TRADING
                        </div>
                        
                        <!-- Network status indicator -->
                        <div class="network-status offline" id="network-status">
                            <div class="network-status-dot offline"></div>
                            <span>Network: Offline</span>
                            <button class="btn btn-sm btn-outline-secondary ms-auto test-connection-btn" id="test-connection-btn">
                                Test
                            </button>
                        </div>
                        
                        <!-- Emergency Sell Button -->
                        <div class="emergency-control">
                            <div class="emergency-trading-notice alert alert-warning mb-2">
                                <i class="fas fa-exclamation-triangle"></i> EMERGENCY USE ONLY
                            </div>
                            <button class="btn btn-sell w-100 py-2" id="emergency-sell-btn">
                                <i class="fas fa-arrow-down"></i> EMERGENCY SELL
                            </button>
                        </div>
                        
                        <!-- Bot Activity Section -->
                        <div class="bot-activity scanning" id="bot-activity">
                            <div><strong>Bot Activity:</strong> <span id="activity-status">Initializing</span></div>
                            <div class="last-tick-info" id="last-tick-info">Last check: Never</div>
                        </div>
                        
                        <!-- Market Data Summary -->
                        <div class="market-data" id="market-data">
                            <div class="market-data-item">
                                <div class="market-label">PRICE</div>
                                <div class="market-value" id="market-price">$0.00</div>
                            </div>
                            <div class="market-data-item">
                                <div class="market-label">24H CHANGE</div>
                                <div class="market-value" id="market-change">0.00%</div>
                            </div>
                            <div class="market-data-item">
                                <div class="market-label">VOLUME</div>
                                <div class="market-value" id="market-volume">$0</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button id="start-trading-btn" class="btn btn-primary w-100 mb-3">🚀 Start Trading</button>
                            <button id="stop-trading-btn" class="btn btn-danger w-100 mb-3" disabled>⏹️ Stop Trading</button>
                            <button id="reset-trading-btn" class="btn btn-warning w-100" disabled>🔄 Reset</button>
                        </div>
                    </div>
                    
                    <!-- Strategy Settings Tab -->
                    <div class="tab-pane fade" id="strategy-settings" role="tabpanel" aria-labelledby="strategy-tab">
                        <h6>📊 Data Settings</h6>
                        <div class="mb-3">
                            <label for="symbol" class="form-label">Symbol</label>
                            <select class="form-select" id="symbol">
                                <option value="BTCUSDT">BTCUSDT</option>
                                <option value="ETHUSDT">ETHUSDT</option>
                                <option value="ADAUSDT">ADAUSDT</option>
                                <option value="SOLUSDT">SOLUSDT</option>
                                <option value="BNBUSDT">BNBUSDT</option>
                                <option value="XRPUSDT">XRPUSDT</option>
                                <option value="DOGEUSDT">DOGEUSDT</option>
                                <option value="DOTUSDT">DOTUSDT</option>
                                <option value="MATICUSDT">MATICUSDT</option>
                                <option value="AVAXUSDT">AVAXUSDT</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="timeframe" class="form-label">Timeframe</label>
                            <select class="form-select" id="timeframe">
                                <option value="1m">1m</option>
                                <option value="5m">5m</option>
                                <option value="15m">15m</option>
                                <option value="30m">30m</option>
                                <option value="1h" selected>1h</option>
                                <option value="4h">4h</option>
                                <option value="1d">1d</option>
                                <option value="1w">1w</option>
                            </select>
                        </div>
                        
                        <h6 class="mt-4">⚙️ Strategy Parameters</h6>
                        
                        <div class="mb-3">
                            <label for="atr-length" class="form-label">ATR Length</label>
                            <input type="range" class="form-range" id="atr-length" min="1" max="50" value="5">
                            <div class="d-flex justify-content-between">
                                <small>1</small>
                                <small id="atr-length-value">5</small>
                                <small>50</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="atr-mult" class="form-label">ATR Multiplier</label>
                            <input type="range" class="form-range" id="atr-mult" min="0.1" max="5.0" step="0.05" value="0.75">
                            <div class="d-flex justify-content-between">
                                <small>0.1</small>
                                <small id="atr-mult-value">0.75</small>
                                <small>5.0</small>
                            </div>
                        </div>
                        
                        <!-- Trading Statistics -->
                        <h6 class="mt-4">📊 Trading Statistics</h6>
                        <div class="stats-panel">
                            <div class="stat-item">
                                <div class="stat-value" id="stat-daily-trades">0</div>
                                <div class="stat-label">Today's Trades</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-daily-pnl">$0.00</div>
                                <div class="stat-label">Today's P&L</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-execution">0ms</div>
                                <div class="stat-label">Execution Time</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trading Settings Tab -->
                    <div class="tab-pane fade" id="trading-settings" role="tabpanel" aria-labelledby="trading-tab">
                        <h6>💰 Trading Settings</h6>
                        
                        <!-- Paper Trading Settings -->
                        <div id="paper-trading-settings">
                            <div class="mb-3">
                                <label for="initial-capital" class="form-label">Initial Capital ($)</label>
                                <input type="number" class="form-control" id="initial-capital" min="1000" max="1000000" value="10000">
                            </div>
                            
                            <div class="mb-3">
                                <label for="position-size" class="form-label">Position Size (%)</label>
                                <input type="range" class="form-range" id="position-size" min="1" max="100" value="10">
                                <div class="d-flex justify-content-between">
                                    <small>1%</small>
                                    <small id="position-size-value">10%</small>
                                    <small>100%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Real Money Trading Settings -->
                        <div id="real-trading-settings" style="display:none;">
                            <div class="mb-3">
                                <label for="order-type" class="form-label">Order Type</label>
                                <select class="form-select" id="order-type">
                                    <option value="MARKET">MARKET</option>
                                    <option value="LIMIT">LIMIT</option>
                                    <option value="STOP_LIMIT">STOP LIMIT</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="trade-amount" class="form-label">Trade Amount (USDT)</label>
                                <input type="number" class="form-control" id="trade-amount" min="10" max="10000" value="50">
                            </div>
                            
                            <div class="mb-3">
                                <label for="max-daily-loss" class="form-label">Max Daily Loss ($)</label>
                                <input type="number" class="form-control" id="max-daily-loss" min="5" max="1000" value="100">
                            </div>
                        </div>
                        
                        <h6 class="mt-4">⚠️ Risk Management</h6>
                        <!-- Risk Management Settings -->
                        <div class="mb-3">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="take-profit-toggle" checked>
                                <label class="form-check-label" for="take-profit-toggle">
                                    Take Profit
                                </label>
                            </div>
                            <div class="input-group mb-3">
                                <input type="number" class="form-control" id="take-profit-value" value="3.0" min="0.1" max="50" step="0.1">
                                <span class="input-group-text">%</span>
                            </div>
                            
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="stop-loss-toggle" checked>
                                <label class="form-check-label" for="stop-loss-toggle">
                                    Stop Loss
                                </label>
                            </div>
                            <div class="input-group mb-3">
                                <input type="number" class="form-control" id="stop-loss-value" value="2.0" min="0.1" max="20" step="0.1">
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="mobile-info" class="mobile-info" style="display: none;">
                    <h6>📱 Mobile Device Detected</h6>
                    <p>This app is optimized for desktop. Some features may be limited on mobile devices.</p>
                </div>
                
                <!-- API Key Management (Only visible in real money mode) -->
                <div id="api-key-section" style="display:none;">
                    <div class="api-key-form">
                        <h6>🔑 API Keys</h6>
                        <div class="api-key-status pending" id="api-key-status">
                            <i class="fas fa-circle-question"></i>
                            <span id="api-key-status-text">Not Configured</span>
                        </div>
                        <div class="mb-2">
                            <label for="api-key" class="form-label">API Key</label>
                            <div class="input-group">
                                <input type="password" class="form-control api-key-mask" id="api-key" placeholder="Enter your Binance API key">
                                <button class="btn btn-outline-secondary" type="button" id="show-api-key-btn">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label for="api-secret" class="form-label">API Secret</label>
                            <div class="input-group">
                                <input type="password" class="form-control api-key-mask" id="api-secret" placeholder="Enter your Binance API secret">
                                <button class="btn btn-outline-secondary" type="button" id="show-api-secret-btn">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button class="btn btn-primary" id="save-api-keys-btn">Save Keys</button>
                        </div>
                        <div class="mt-2 small">
                            <i class="fas fa-lock"></i> Keys are stored locally and never sent to any server.
                        </div>
                    </div>
                </div>
                
                <!-- Real Money Warning (Only visible in real money mode) -->
                <div id="real-money-warning" class="real-money-warning" style="display:none;">
                    <h6>⚠️ REAL MONEY TRADING</h6>
                    <p>You are in <strong>REAL MONEY</strong> mode. All trades will use actual funds from your Binance account.</p>
                    <p>Please ensure you understand the risks before proceeding.</p>
                </div>
                
                <!-- Account Balance (Only visible in real money mode) -->
                <div id="balance-section" class="balance-section" style="display:none;">
                    <h6>💰 Account Balance</h6>
                    <div class="balance-item">
                        <span>USDT Available:</span>
                        <span class="balance-value" id="usdt-balance">0.00</span>
                    </div>
                    <div class="balance-item">
                        <span>BTC Holdings:</span>
                        <span class="balance-value" id="btc-balance">0.00000000</span>
                    </div>
                    <div class="balance-item">
                        <span>Est. Total Value:</span>
                        <span class="balance-value" id="total-balance">$0.00</span>
                    </div>
                </div>
            </div>
            
            <!-- Main content -->
            <div class="main-content">
                <h1 class="gradient-header">Volty Strategy Trading Bot <span class="pro-badge">PRO</span></h1>
                
                <!-- Performance Metrics -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="total-return">0.00%</div>
                            <div class="metric-label">💰 Total Return</div>
                            <div class="metric-delta" id="total-return-delta">$0.00</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="win-rate">0.0%</div>
                            <div class="metric-label">🎯 Win Rate</div>
                            <div class="metric-delta" id="win-rate-delta">0 trades</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="profit-factor">0.00</div>
                            <div class="metric-label">📈 Profit Factor</div>
                            <div class="metric-delta" id="profit-factor-delta">Avg: $0.00</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="max-drawdown">0.00%</div>
                            <div class="metric-label">📉 Max Drawdown</div>
                            <div class="metric-delta" id="max-drawdown-delta">Sharpe: 0.00</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="max-win">$0.00</div>
                            <div class="metric-label">🏆 Max Win</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="max-loss">$0.00</div>
                            <div class="metric-label">💸 Max Loss</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="final-capital">$10,000.00</div>
                            <div class="metric-label">💼 Current Capital</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="total-trades">0</div>
                            <div class="metric-label">⚡ Total Trades</div>
                        </div>
                    </div>
                </div>
                
                            <h5>🔴 Current Position</h5>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="metric-label">Type</div>
                                    <div class="metric-value" id="position-type">-</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Entry Price</div>
                                    <div class="metric-value" id="position-entry-price">$0.00</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Current Price</div>
                                    <div class="metric-value" id="position-current-price">$0.00</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Unrealized P&L</div>
                                    <div class="metric-value" id="position-pnl">$0.00 (0.00%)</div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="metric-label">Entry Time</div>
                                    <div class="small" id="position-entry-time">-</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Position Size</div>
                                    <div class="small" id="position-size-info">0.00000000</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Take Profit</div>
                                    <div class="small" id="position-tp">$0.00</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-label">Stop Loss</div>
                                    <div class="small" id="position-sl">$0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="card mt-4">
                    <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts-content" type="button" role="tab" aria-controls="charts-content" aria-selected="true">
                                📊 Charts
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="trades-tab" data-bs-toggle="tab" data-bs-target="#trades-content" type="button" role="tab" aria-controls="trades-content" aria-selected="false">
                                🧾 Trade History
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-content" type="button" role="tab" aria-controls="settings-content" aria-selected="false">
                                ⚙️ Settings
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="mainTabContent">
                        <!-- Charts Tab -->
                        <div class="tab-pane fade show active" id="charts-content" role="tabpanel" aria-labelledby="charts-tab">
                            <div class="chart-controls">
                                <div class="auto-scroll-toggle">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="auto-scroll-toggle" checked>
                                        <label class="form-check-label" for="auto-scroll-toggle">Auto-scroll</label>
                                    </div>
                                </div>
                                <div>
                                    <button class="chart-control-button" id="refresh-chart-btn">
                                        <i class="fas fa-sync-alt"></i> Refresh
                                    </button>
                                </div>
                            </div>
                            
                            <ul class="nav nav-tabs mt-3" id="chartTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="price-tab" data-bs-toggle="tab" data-bs-target="#price-content" type="button" role="tab" aria-controls="price-content" aria-selected="true">
                                        📈 Price Chart & Signals
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="equity-tab" data-bs-toggle="tab" data-bs-target="#equity-content" type="button" role="tab" aria-controls="equity-content" aria-selected="false">
                                        💹 Equity Curve
                                    </button>
                                </li>
                            </ul>
                            <div class="tab-content" id="chartTabContent">
                                <div class="tab-pane fade show active" id="price-content" role="tabpanel" aria-labelledby="price-tab">
                                    <div class="chart-container" style="position: relative; height: 60vh;">
                                        <div class="chart-tools">
                                            <div class="chart-tool-button" id="chart-zoom-in">
                                                <i class="fas fa-search-plus"></i>
                                            </div>
                                            <div class="chart-tool-button" id="chart-zoom-out">
                                                <i class="fas fa-search-minus"></i>
                                            </div>
                                            <div class="chart-tool-button" id="chart-reset">
                                                <i class="fas fa-home"></i>
                                            </div>
                                        </div>
                                        <div id="priceChart"></div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="equity-content" role="tabpanel" aria-labelledby="equity-tab">
                                    <div class="chart-container" style="position: relative; height: 40vh;">
                                        <div id="equityChart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Trade History Tab -->
                        <div class="tab-pane fade" id="trades-content" role="tabpanel" aria-labelledby="trades-tab">
                            <div class="export-controls mb-3">
                                <button class="export-button" id="export-trades-btn">
                                    <i class="fas fa-file-export"></i> Export Trades
                                </button>
                                <button class="export-button" id="export-logs-btn">
                                    <i class="fas fa-file-alt"></i> Export Logs
                                </button>
                            </div>
                            
                            <h5 class="mt-3 mb-3">📋 Trade History</h5>
                            <div class="table-responsive">
                                <table class="trade-history" id="tradeHistory">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Entry Time</th>
                                            <th>Exit Time</th>
                                            <th>Type</th>
                                            <th>Entry Price</th>
                                            <th>Exit Price</th>
                                            <th>Size</th>
                                            <th>P&L</th>
                                            <th>P&L %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Trade history will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Settings Tab -->
                        <div class="tab-pane fade" id="settings-content" role="tabpanel" aria-labelledby="settings-tab">
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="card settings-card">
                                        <h5>🔧 General Settings</h5>
                                        
                                        <div class="settings-group">
                                            <label for="theme-select" class="form-label">Theme</label>
                                            <select class="form-select" id="theme-select">
                                                <option value="dark">Dark Theme</option>
                                                <option value="light">Light Theme</option>
                                            </select>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <label for="chart-update-frequency" class="form-label">Chart Update Frequency (seconds)</label>
                                            <input type="number" class="form-control" id="chart-update-frequency" min="1" max="60" value="5">
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3 settings-group">
                                            <input class="form-check-input" type="checkbox" id="auto-trade-toggle" checked>
                                            <label class="form-check-label" for="auto-trade-toggle">
                                                Auto Trade
                                            </label>
                                            <div class="form-text">Automatically execute trades based on signals</div>
                                        </div>
                                    </div>
                                    
                                    <div class="card settings-card">
                                        <h5>📊 Chart Settings</h5>
                                        
                                        <div class="settings-group">
                                            <label for="chart-type" class="form-label">Chart Type</label>
                                            <select class="form-select" id="chart-type">
                                                <option value="candlestick" selected>Candlestick</option>
                                                <option value="line">Line</option>
                                                <option value="ohlc">OHLC</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3 settings-group">
                                            <input class="form-check-input" type="checkbox" id="show-volume-toggle" checked>
                                            <label class="form-check-label" for="show-volume-toggle">
                                                Show Volume
                                            </label>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3 settings-group">
                                            <input class="form-check-input" type="checkbox" id="show-indicators-toggle" checked>
                                            <label class="form-check-label" for="show-indicators-toggle">
                                                Show Indicators
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card settings-card">
                                        <h5>⚠️ Risk Management</h5>
                                        
                                        <div class="form-check form-switch mb-2 settings-group">
                                            <input class="form-check-input" type="checkbox" id="risk-management-toggle">
                                            <label class="form-check-label" for="risk-management-toggle">
                                                Enable Risk Management
                                            </label>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <label for="max-drawdown-value" class="form-label">Maximum Drawdown (%)</label>
                                            <input type="number" class="form-control" id="max-drawdown-value" min="1" max="50" value="10" disabled>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <label for="max-daily-loss-value" class="form-label">Maximum Daily Loss (%)</label>
                                            <input type="number" class="form-control" id="max-daily-loss-value" min="1" max="20" value="5" disabled>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-2 settings-group">
                                            <input class="form-check-input" type="checkbox" id="trailing-stop-toggle">
                                            <label class="form-check-label" for="trailing-stop-toggle">
                                                Trailing Stop
                                            </label>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <label for="trailing-stop-value" class="form-label">Trailing Stop (%)</label>
                                            <input type="number" class="form-control" id="trailing-stop-value" min="0.1" max="10" step="0.1" value="1.5" disabled>
                                        </div>
                                    </div>
                                    
                                    <div class="card settings-card">
                                        <h5>🌐 Network Settings</h5>
                                        
                                        <div class="settings-group">
                                            <label for="retry-attempts" class="form-label">API Retry Attempts</label>
                                            <input type="number" class="form-control" id="retry-attempts" min="1" max="10" value="3">
                                        </div>
                                        
                                        <div class="settings-group">
                                            <label for="timeout-seconds" class="form-label">Request Timeout (seconds)</label>
                                            <input type="number" class="form-control" id="timeout-seconds" min="5" max="60" value="30">
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3 settings-group">
                                            <input class="form-check-input" type="checkbox" id="fallback-api-toggle" checked>
                                            <label class="form-check-label" for="fallback-api-toggle">
                                                Use Public API Fallback
                                            </label>
                                            <div class="form-text">Use public API when authenticated API fails</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="card settings-card">
                                        <h5>🔔 Notification Settings</h5>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check form-switch mb-3 settings-group">
                                                    <input class="form-check-input" type="checkbox" id="browser-alert-toggle" checked>
                                                    <label class="form-check-label" for="browser-alert-toggle">
                                                        Browser Notifications
                                                    </label>
                                                </div>
                                                
                                                <div class="form-check form-switch mb-3 settings-group">
                                                    <input class="form-check-input" type="checkbox" id="sound-alert-toggle" checked>
                                                    <label class="form-check-label" for="sound-alert-toggle">
                                                        Sound Alerts
                                                    </label>
                                                </div>
                                                
                                                <div class="settings-group">
                                                    <label for="sound-volume-input" class="form-label">Sound Volume</label>
                                                    <input type="range" class="form-range" id="sound-volume-input" min="0" max="1" step="0.1" value="0.5">
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-6">
                                                <div class="form-check form-switch mb-3 settings-group">
                                                    <input class="form-check-input" type="checkbox" id="discord-alert-toggle">
                                                    <label class="form-check-label" for="discord-alert-toggle">
                                                        Discord Notifications
                                                    </label>
                                                </div>
                                                
                                                <div class="discord-settings" id="discord-settings" style="display:none;">
                                                    <div class="settings-group">
                                                        <label for="discord-webhook-input" class="form-label">Discord Webhook URL</label>
                                                        <input type="text" class="form-control" id="discord-webhook-input" placeholder="Enter Discord webhook URL">
                                                    </div>
                                                    
                                                    <div class="form-check form-switch mb-2">
                                                        <input class="form-check-input" type="checkbox" id="discord-trade-alerts" checked>
                                                        <label class="form-check-label" for="discord-trade-alerts">
                                                            Trade Alerts
                                                        </label>
                                                    </div>
                                                    
                                                    <div class="form-check form-switch mb-2">
                                                        <input class="form-check-input" type="checkbox" id="discord-include-chart" checked>
                                                        <label class="form-check-label" for="discord-include-chart">
                                                            Include Chart
                                                        </label>
                                                    </div>
                                                    
                                                    <div class="form-check form-switch mb-2">
                                                        <input class="form-check-input" type="checkbox" id="discord-include-metrics" checked>
                                                        <label class="form-check-label" for="discord-include-metrics">
                                                            Include Metrics
                                                        </label>
                                                    </div>
                                                    
                                                    <h6 class="mt-3 mb-2">Preview:</h6>
                                                    <div class="discord-preview">
                                                        <div class="discord-message">
                                                            <div class="discord-title">🤖 Volty PRO Trading Bot</div>
                                                            <div class="discord-content">New trading signal detected!</div>
                                                            <div class="discord-embed">
                                                                <div class="discord-title">LONG Entry Signal - BTCUSDT</div>
                                                                <div class="discord-field">
                                                                    <div class="discord-field-name">Entry Price:</div>
                                                                    <div class="discord-field-value">$65,432.10</div>
                                                                </div>
                                                                <div class="discord-field">
                                                                    <div class="discord-field-name">Position Size:</div>
                                                                    <div class="discord-field-value">0.15 BTC ($9,814.82)</div>
                                                                </div>
                                                                <div class="discord-field">
                                                                    <div class="discord-field-name">Take Profit:</div>
                                                                    <div class="discord-field-value">$67,395.06 (+3.0%)</div>
                                                                </div>
                                                                <div class="discord-field">
                                                                    <div class="discord-field-name">Stop Loss:</div>
                                                                    <div class="discord-field-value">$64,123.46 (-2.0%)</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <button class="btn btn-primary btn-sm mt-2" id="test-discord-btn">
                                                        <i class="fas fa-paper-plane"></i> Send Test Message
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-12 d-grid">
                                    <button type="button" class="btn btn-primary" id="save-all-settings-btn">
                                        💾 Save All Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Log Messages -->
                <div class="card mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">📝 Trading Log</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="clear-log-btn">
                            <i class="fas fa-trash"></i> Clear Log
                        </button>
                    </div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        <div id="logMessages">
                            <!-- Log messages will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <script>
    // Constants and settings
    const CURRENT_UTC_DATETIME = '2025-06-07 00:18:06';
    const CURRENT_USER = 'gelimorto2';
    const BINANCE_API_URL = 'https://api.binance.com/api/v3';
    const BINANCE_API_TRADE_URL = 'https://api.binance.com/api/v3';
    const POLL_INTERVAL = 5000; // 5 seconds
    const OHLC_COLORS = {
        up: 'rgba(34, 197, 94, 0.8)',
        down: 'rgba(239, 68, 68, 0.8)',
        upFill: 'rgba(34, 197, 94, 0.2)',
        downFill: 'rgba(239, 68, 68, 0.2)',
        volume: {
            up: 'rgba(34, 197, 94, 0.5)',
            down: 'rgba(239, 68, 68, 0.5)'
        }
    };

    // Application state
    const state = {
        priceData: [],
        trades: [],
        historicalTrades: [],
        equityCurve: [],
        currentPosition: null,
        isTrading: false,
        initialCapital: 10000,
        currentCapital: 10000,
        positionSize: 0.1,
        atrLength: 5,
        atrMultiplier: 0.75,
        symbol: 'BTCUSDT',
        timeframe: '1h',
        currentPrice: 0,
        currentUser: CURRENT_USER,
        currentDateTime: CURRENT_UTC_DATETIME,
        indicators: {
            atr: [],
            longSignal: [],
            shortSignal: []
        },
        interval: null,
        charts: {
            price: null,
            equity: null
        },
        metrics: {
            totalReturn: 0,
            winRate: 0,
            profitFactor: 0,
            maxDrawdown: 0,
            sharpeRatio: 0,
            totalTrades: 0,
            avgTrade: 0,
            maxWin: 0,
            maxLoss: 0
        },
        backtest: {
            capital: 10000,
            trades: []
        },
        alerts: {
            discord: {
                enabled: false,
                webhook: '',
                includeChart: true,
                includeMetrics: true,
                includeSignals: true,
                includeTrades: true
            },
            telegram: {
                enabled: false,
                botToken: '',
                chatId: ''
            },
            email: {
                enabled: false,
                address: ''
            },
            browser: {
                enabled: true
            },
            sound: {
                enabled: true,
                volume: 0.5
            }
        },
        settings: {
            theme: 'dark',
            chartUpdateFrequency: 5000,
            autoTrade: true,
            trailingStop: {
                enabled: false,
                percentage: 1.5
            },
            takeProfit: {
                enabled: true,
                percentage: 3.0
            },
            stopLoss: {
                enabled: true,
                percentage: 2.0
            },
            riskManagement: {
                enabled: false,
                maxDrawdown: 10,
                maxDailyLoss: 5
            },
            chart: {
                autoScroll: true,
                type: 'candlestick',
                showVolume: true,
                showIndicators: true
            },
            export: {
                directory: './trading_data',
                autoExport: false,
                jsonFormat: true
            },
            network: {
                retryAttempts: 3,
                timeoutSeconds: 30,
                usePublicApiFallback: true
            }
        },
        botStats: {
            status: 'idle',
            lastTickTime: null,
            lastTickPrice: 0,
            executionTime: 0,
            dailyTrades: 0,
            dailyPnL: 0,
            dailyStartCapital: 0,
            marketData: {
                price: 0,
                change24h: 0,
                volume: 0
            },
            tradingDay: new Date().toDateString(),
            positionDetails: {
                entryTime: null,
                takeProfitPrice: 0,
                stopLossPrice: 0,
                highestPnl: null
            },
            networkStatus: {
                isOnline: false,
                lastChecked: null,
                failCount: 0
            }
        },
        // Real money trading specific state
        realMoney: {
            enabled: false,
            apiKey: '',
            apiSecret: '',
            apiKeyValid: false,
            orderType: 'MARKET',
            tradeAmount: 50,
            maxDailyLoss: 100,
            leverage: 1,
            slippage: 0.1,
            cooldown: 5,
            tradingHours: '0-23',
            balance: {
                USDT: 0,
                BTC: 0,
                totalValue: 0
            },
            pendingOrder: null,
            openOrders: [],
            realTrades: []
        },
        logs: []
    };

    // Notification sound
    let notificationSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3');

    // Login system functionality
    const loginSystem = {
        isLoggedIn: false,
        username: CURRENT_USER,
        defaultPassword: 'trading2025',
        loginModal: null,
        
        init() {
            setTimeout(() => {
                try {
                    this.loginModal = new bootstrap.Modal(document.getElementById('loginModal'), {
                        backdrop: 'static',
                        keyboard: false
                    });
                    
                    this.showLogin();
                    
                    document.getElementById('login-submit-btn').addEventListener('click', () => this.attemptLogin());
                    document.getElementById('toggle-password-btn').addEventListener('click', this.togglePasswordVisibility);
                    
                    document.getElementById('login-password').addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.attemptLogin();
                        }
                    });
                } catch (error) {
                    console.error('Error initializing login modal:', error);
                    try {
                        $('#loginModal').modal('show');
                    } catch (e) {
                        console.error('Error showing login modal with jQuery:', e);
                    }
                }
            }, 500);
        },
        
        showLogin() {
            document.getElementById('login-error').style.display = 'none';
            document.getElementById('login-password').value = '';
            
            document.getElementById('login-username').value = this.username;
            
            if (this.loginModal) {
                this.loginModal.show();
            } else {
                setTimeout(() => {
                    try {
                        this.loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                        this.loginModal.show();
                    } catch (error) {
                        console.error('Error showing login modal:', error);
                        try {
                            $('#loginModal').modal('show');
                        } catch (e) {
                            console.error('Error showing login modal with jQuery:', e);
                        }
                    }
                }, 100);
            }
        },
        
        togglePasswordVisibility() {
            const passwordInput = document.getElementById('login-password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                icon.className = 'fas fa-eye';
            }
        },
        
        checkRememberedLogin() {
            try {
                const remembered = localStorage.getItem('voltyBotRememberedLogin');
                if (remembered) {
                    const loginData = JSON.parse(remembered);
                    const expiryDate = new Date(loginData.expiry);
                    
                    if (expiryDate > new Date()) {
                        return true;
                    }
                    
                    localStorage.removeItem('voltyBotRememberedLogin');
                }
            } catch (error) {
                console.error('Error checking remembered login:', error);
            }
            
            return false;
        },
        
        saveRememberedLogin() {
            try {
                if (document.getElementById('remember-login').checked) {
                    const expiry = new Date();
                    expiry.setDate(expiry.getDate() + 30);
                    
                    const loginData = {
                        username: this.username,
                        expiry: expiry.toISOString()
                    };
                    
                    localStorage.setItem('voltyBotRememberedLogin', JSON.stringify(loginData));
                }
            } catch (error) {
                console.error('Error saving remembered login:', error);
            }
        },
        
        attemptLogin() {
            const passwordInput = document.getElementById('login-password').value;
            
            if (passwordInput === this.defaultPassword) {
                this.isLoggedIn = true;
                this.saveRememberedLogin();
                
                try {
                    this.loginModal.hide();
                } catch (error) {
                    console.error('Error hiding login modal:', error);
                    try {
                        $('#loginModal').modal('hide');
                    } catch (e) {
                        console.error('Error hiding login modal with jQuery:', e);
                    }
                }
                
                initializeAfterLogin();
                addLogMessage('Login successful', false);
            } else {
                document.getElementById('login-error').style.display = 'block';
                document.getElementById('login-password').value = '';
            }
        },
        
        logout() {
            this.isLoggedIn = false;
            localStorage.removeItem('voltyBotRememberedLogin');
            window.location.reload();
        }
    };

    // Data classes
    class Trade {
        constructor(entryTime, type, entryPrice, size, isRealMoney = false, orderId = null) {
            this.entryTime = entryTime;
            this.exitTime = null;
            this.type = type; // 'LONG' or 'SHORT'
            this.entryPrice = entryPrice;
            this.exitPrice = null;
            this.size = size;
            this.pnl = 0;
            this.pnlPct = 0;
            this.isRealMoney = isRealMoney;
            this.orderId = orderId; // Binance order ID for real money trades
        }

        close(exitTime, exitPrice) {
            this.exitTime = exitTime;
            this.exitPrice = exitPrice;
            
            if (this.type === 'LONG') {
                this.pnl = (exitPrice - this.entryPrice) * this.size;
                this.pnlPct = (exitPrice - this.entryPrice) / this.entryPrice;
            } else { // SHORT
                this.pnl = (this.entryPrice - exitPrice) * this.size;
                this.pnlPct = (this.entryPrice - exitPrice) / this.entryPrice;
            }
            
            return this.pnl;
        }

        getUnrealizedPnl(currentPrice) {
            if (this.type === 'LONG') {
                return (currentPrice - this.entryPrice) * this.size;
            } else { // SHORT
                return (this.entryPrice - currentPrice) * this.size;
            }
        }

        getUnrealizedPnlPct(currentPrice) {
            if (this.type === 'LONG') {
                return (currentPrice - this.entryPrice) / this.entryPrice;
            } else { // SHORT
                return (this.entryPrice - currentPrice) / this.entryPrice;
            }
        }
    }

    // Strategy and Trading logic
    class VoltyStrategy {
        constructor(length = 5, atrMult = 0.75) {
            this.length = length;
            this.atrMult = atrMult;
        }

        calculateATR(data) {
            const trueRanges = [];
            
            for (let i = 0; i < data.length; i++) {
                const high = data[i].high;
                const low = data[i].low;
                const close = i > 0 ? data[i-1].close : data[i].open;
                
                const tr1 = high - low;
                const tr2 = Math.abs(high - close);
                const tr3 = Math.abs(low - close);
                
                const tr = Math.max(tr1, Math.max(tr2, tr3));
                trueRanges.push(tr);
            }
            
            // Calculate simple moving average of true ranges
            const atr = [];
            for (let i = 0; i < trueRanges.length; i++) {
                if (i < this.length - 1) {
                    atr.push(null);
                } else {
                    let sum = 0;
                    for (let j = 0; j < this.length; j++) {
                        sum += trueRanges[i - j];
                    }
                    atr.push(sum / this.length);
                }
            }
            
            return atr;
        }

        generateSignals(data) {
            // Calculate ATR
            const atr = this.calculateATR(data);
            const atrs = atr.map(val => val !== null ? val * this.atrMult : null);
            
            // Calculate signal levels
            const longSignal = [];
            const shortSignal = [];
            
            for (let i = 0; i < data.length; i++) {
                if (atrs[i] === null) {
                    longSignal.push(null);
                    shortSignal.push(null);
                } else {
                    longSignal.push(data[i].close + atrs[i]);
                    shortSignal.push(data[i].close - atrs[i]);
                }
            }
            
            // Generate entry signals
            const longEntry = [];
            const shortEntry = [];
            
            for (let i = 2; i < data.length; i++) {
                // Long entry: current high >= previous long signal AND previous high < signal before that
                const isLongEntry = data[i].high >= longSignal[i-1] && data[i-1].high < longSignal[i-2];
                
                // Short entry: current low <= previous short signal AND previous low > signal before that
                const isShortEntry = data[i].low <= shortSignal[i-1] && data[i-1].low > shortSignal[i-2];
                
                longEntry.push(isLongEntry);
                shortEntry.push(isShortEntry);
            }
            
            return {
                atr,
                atrs,
                longSignal,
                shortSignal,
                longEntry,
                shortEntry
            };
        }

        // Method to check for real-time signals
        checkRealtimeSignals(data, lastSignals) {
            if (data.length < 3) return { longEntry: false, shortEntry: false };
            
            const currentBar = data[data.length - 1];
            const previousBar = data[data.length - 2];
            
            // Get the most recent long and short signal levels
            const recentLongSignal = lastSignals.longSignal[lastSignals.longSignal.length - 2]; // Previous bar's signal
            const recentShortSignal = lastSignals.shortSignal[lastSignals.shortSignal.length - 2]; // Previous bar's signal
            
            // Get the signal level from two bars back
            const olderLongSignal = lastSignals.longSignal[lastSignals.longSignal.length - 3]; // Two bars back signal
            const olderShortSignal = lastSignals.shortSignal[lastSignals.shortSignal.length - 3]; // Two bars back signal
            
            // Check for long entry: current high crosses above previous long signal AND previous high was below signal before that
            const isLongEntry = currentBar.high >= recentLongSignal && previousBar.high < olderLongSignal;
            
            // Check for short entry: current low crosses below previous short signal AND previous low was above signal before that
            const isShortEntry = currentBar.low <= recentShortSignal && previousBar.low > olderShortSignal;
            
            return {
                longEntry: isLongEntry,
                shortEntry: isShortEntry
            };
        }
    }

    // Binance API client
    class BinanceAPI {
        constructor(apiKey = '', apiSecret = '') {
            this.apiKey = apiKey;
            this.apiSecret = apiSecret;
            this.baseUrl = 'https://api.binance.com';
            this.useAuthentication = apiKey && apiSecret;
        }
        
        // Generate signature for authenticated requests
        generateSignature(queryString) {
            return CryptoJS.HmacSHA256(queryString, this.apiSecret).toString();
        }
        
        // Generate headers for authenticated requests
        getHeaders() {
            return this.useAuthentication ? 
                { 'X-MBX-APIKEY': this.apiKey } : 
                {};
        }
        
        // Test connectivity to the API
        async testConnectivity() {
            try {
                const response = await axios.get(`${this.baseUrl}/api/v3/ping`, {
                    timeout: state.settings.network.timeoutSeconds * 1000
                });
                return response.status === 200;
            } catch (error) {
                console.error('Error testing connectivity:', error);
                if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
                    throw new Error('Network timeout. Please check your internet connection.');
                } else if (error.code === 'ERR_NETWORK') {
                    throw new Error('Network error. Unable to connect to Binance servers.');
                }
                return false;
            }
        }
        
        // Get account information (authenticated)
        async getAccountInfo() {
            if (!this.useAuthentication) {
                throw new Error('API key and secret required for account information');
            }
            
            try {
                const timestamp = Date.now();
                const queryString = `timestamp=${timestamp}`;
                const signature = this.generateSignature(queryString);
                
                const response = await axios.get(
                    `${this.baseUrl}/api/v3/account?${queryString}&signature=${signature}`,
                    { 
                        headers: this.getHeaders(),
                        timeout: state.settings.network.timeoutSeconds * 1000
                    }
                );
                
                return response.data;
            } catch (error) {
                if (error.response && error.response.data) {
                    throw new Error(`Binance API error: ${error.response.data.msg || JSON.stringify(error.response.data)}`);
                } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
                    throw new Error('Network timeout when fetching account information.');
                } else if (error.code === 'ERR_NETWORK') {
                    throw new Error('Network error. Unable to connect to Binance servers.');
                }
                throw error;
            }
        }
        
        // Get current price for a symbol (public API)
        async getCurrentPrice(symbol) {
            try {
                const response = await axios.get(`${this.baseUrl}/api/v3/ticker/price?symbol=${symbol}`, {
                    timeout: state.settings.network.timeoutSeconds * 1000
                });
                return parseFloat(response.data.price);
            } catch (error) {
                if (error.response && error.response.data) {
                    throw new Error(`Binance API error: ${error.response.data.msg || JSON.stringify(error.response.data)}`);
                } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
                    throw new Error('Network timeout when fetching price data.');
                } else if (error.code === 'ERR_NETWORK') {
                    throw new Error('Network error. Unable to connect to Binance servers.');
                }
                throw error;
            }
        }
        
        // Get historical klines (candlestick data) - public API
        async getHistoricalData(symbol, interval, limit = 100) {
            try {
                const response = await axios.get(`${this.baseUrl}/api/v3/klines`, {
                    params: {
                        symbol,
                        interval,
                        limit
                    },
                    timeout: state.settings.network.timeoutSeconds * 1000
                });
                
                return response.data.map(candle => ({
                    time: candle[0],
                    open: parseFloat(candle[1]),
                    high: parseFloat(candle[2]),
                    low: parseFloat(candle[3]),
                    close: parseFloat(candle[4]),
                    volume: parseFloat(candle[5])
                }));
            } catch (error) {
                if (error.response && error.response.data) {
                    throw new Error(`Binance API error: ${error.response.data.msg || JSON.stringify(error.response.data)}`);
                } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
                    throw new Error('Network timeout when fetching historical data.');
                } else if (error.code === 'ERR_NETWORK') {
                    throw new Error('Network error. Unable to connect to Binance servers.');
                }
                throw error;
            }
        }
        
        // Get 24hr ticker for symbol (public API)
        async get24hrTicker(symbol) {
            try {
                const response = await axios.get(`${this.baseUrl}/api/v3/ticker/24hr?symbol=${symbol}`, {
                    timeout: state.settings.network.timeoutSeconds * 1000
                });
                
                return {
                    priceChange: parseFloat(response.data.priceChange),
                    priceChangePercent: parseFloat(response.data.priceChangePercent),
                    weightedAvgPrice: parseFloat(response.data.weightedAvgPrice),
                    lastPrice: parseFloat(response.data.lastPrice),
                    volume: parseFloat(response.data.volume),
                    quoteVolume: parseFloat(response.data.quoteVolume)
                };
            } catch (error) {
                if (error.response && error.response.data) {
                    throw new Error(`Binance API error: ${error.response.data.msg || JSON.stringify(error.response.data)}`);
                } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
                    throw new Error('Network timeout when fetching 24hr ticker data.');
                } else if (error.code === 'ERR_NETWORK') {
                    throw new Error('Network error. Unable to connect to Binance servers.');
                }
                throw error;
            }
        }
        
        // Get account balance (authenticated)
        async getBalance() {
            if (!this.useAuthentication) {
                throw new Error('API key and secret required for account balance');
            }
            
            try {
                const accountInfo = await this.getAccountInfo();
                
                // Extract balances
                const balances = {};
                for (const asset of accountInfo.balances) {
                    balances[asset.asset] = {
                        free: parseFloat(asset.free),
                        locked: parseFloat(asset.locked)
                    };
                }
                
                return balances;
            } catch (error) {
                throw error;
            }
        }
    }

    // Helper function to format large numbers
    function formatLargeNumber(num) {
        if (num >= 1e9) {
            return `$${(num / 1e9).toFixed(2)}B`;
        } else if (num >= 1e6) {
            return `$${(num / 1e6).toFixed(2)}M`;
        } else if (num >= 1e3) {
            return `$${(num / 1e3).toFixed(2)}K`;
        } else {
            return `$${num.toFixed(2)}`;
        }
    }

    // Discord notification handler
    const DiscordNotifier = {
        async sendMessage(message, embeds = [], webhook = null) {
            if (!state.alerts.discord.enabled) {
                return false;
            }
            
            try {
                const webhookUrl = webhook || state.alerts.discord.webhook;
                
                if (!webhookUrl) {
                    throw new Error('Discord webhook URL is not configured');
                }
                
                const payload = {
                    content: message,
                    embeds: embeds,
                    username: 'Volty PRO Trading Bot',
                    avatar_url: 'https://img.icons8.com/fluency/48/000000/stocks-growth.png'
                };
                
                const response = await axios.post(webhookUrl, payload, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                return response.status === 204;
            } catch (error) {
                console.error('Error sending Discord notification:', error);
                addLogMessage('Failed to send Discord notification: ' + error.message, true);
                return false;
            }
        },
        
        // Send trade notification
        async sendTradeNotification(trade, currentPrice = null) {
            if (!state.alerts.discord.enabled || !state.alerts.discord.includeTrades) {
                return false;
            }
            
            const isTradeClosed = trade.exitTime !== null;
            const color = trade.type === 'LONG' ? 3066993 : 15158332; // Green for long, red for short
            
            let title, description, fields = [];
            
            if (isTradeClosed) {
                // Closed trade notification
                const isProfitable = trade.pnl > 0;
                
                title = `${trade.type} Position Closed - ${state.symbol}`;
                description = `Trade ${isProfitable ? 'Profit' : 'Loss'}: ${isProfitable ? '+' : ''}$${trade.pnl.toFixed(2)} (${(trade.pnlPct * 100).toFixed(2)}%)`;
                
                fields = [
                    {
                        name: 'Entry Price',
                        value: `$${trade.entryPrice.toFixed(2)}`,
                        inline: true
                    },
                    {
                        name: 'Exit Price',
                        value: `$${trade.exitPrice.toFixed(2)}`,
                        inline: true
                    },
                    {
                        name: 'Position Size',
                        value: `${trade.size.toFixed(8)} (${formatLargeNumber(trade.size * trade.entryPrice)})`,
                        inline: true
                    },
                    {
                        name: 'Entry Time',
                        value: new Date(trade.entryTime).toLocaleString(),
                        inline: true
                    },
                    {
                        name: 'Exit Time',
                        value: new Date(trade.exitTime).toLocaleString(),
                        inline: true
                    },
                    {
                        name: 'Duration',
                        value: this.formatDuration(new Date(trade.exitTime) - new Date(trade.entryTime)),
                        inline: true
                    }
                ];
            } else {
                // New trade notification
                title = `${trade.type} Entry Signal - ${state.symbol}`;
                description = `New position opened at $${trade.entryPrice.toFixed(2)}`;
                
                const takeProfitPrice = trade.type === 'LONG' 
                    ? trade.entryPrice * (1 + state.settings.takeProfit.percentage / 100) 
                    : trade.entryPrice * (1 - state.settings.takeProfit.percentage / 100);
                
                const stopLossPrice = trade.type === 'LONG'
                    ? trade.entryPrice * (1 - state.settings.stopLoss.percentage / 100)
                    : trade.entryPrice * (1 + state.settings.stopLoss.percentage / 100);
                
                fields = [
                    {
                        name: 'Entry Price',
                        value: `$${trade.entryPrice.toFixed(2)}`,
                        inline: true
                    },
                    {
                        name: 'Current Price',
                        value: currentPrice ? `$${currentPrice.toFixed(2)}` : 'N/A',
                        inline: true
                    },
                    {
                        name: 'Position Size',
                        value: `${trade.size.toFixed(8)} (${formatLargeNumber(trade.size * trade.entryPrice)})`,
                        inline: true
                    },
                    {
                        name: 'Take Profit',
                        value: `$${takeProfitPrice.toFixed(2)} (${state.settings.takeProfit.percentage}%)`,
                        inline: true
                    },
                    {
                        name: 'Stop Loss',
                        value: `$${stopLossPrice.toFixed(2)} (${state.settings.stopLoss.percentage}%)`,
                        inline: true
                    },
                    {
                        name: 'Entry Time',
                        value: new Date(trade.entryTime).toLocaleString(),
                        inline: true
                    }
                ];
            }
            
            const embed = {
                title: title,
                description: description,
                color: color,
                fields: fields,
                timestamp: new Date().toISOString(),
                footer: {
                    text: `Volty PRO Trading Bot | ${trade.isRealMoney ? 'REAL MONEY' : 'Paper Trading'}`
                }
            };
            
            // Include current metrics if enabled
            if (state.alerts.discord.includeMetrics) {
                embed.fields.push({
                    name: 'Current Metrics',
                    value: `Total Return: ${state.metrics.totalReturn.toFixed(2)}% | Win Rate: ${state.metrics.winRate.toFixed(1)}% | Trades: ${state.metrics.totalTrades}`,
                    inline: false
                });
            }
            
            return await this.sendMessage('', [embed]);
        },
        
        // Helper to format duration
        formatDuration(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days}d ${hours % 24}h`;
            } else if (hours > 0) {
                return `${hours}h ${minutes % 60}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds % 60}s`;
            } else {
                return `${seconds}s`;
            }
        },
        
        // Send test message
        async sendTestMessage() {
            const embed = {
                title: '🤖 Volty PRO Bot Test Message',
                description: 'This is a test notification to verify your Discord webhook is working correctly.',
                color: 3447003, // Blue color
                fields: [
                    {
                        name: 'Current Symbol',
                        value: state.symbol,
                        inline: true
                    },
                    {
                        name: 'Trading Mode',
                        value: state.realMoney.enabled ? 'REAL MONEY' : 'Paper Trading',
                        inline: true
                    },
                    {
                        name: 'Current Time',
                        value: new Date().toLocaleString(),
                        inline: true
                    }
                ],
                timestamp: new Date().toISOString(),
                footer: {
                    text: 'Volty PRO Trading Bot'
                }
            };
            
            return await this.sendMessage('✅ Test notification from Volty PRO Trading Bot', [embed]);
        }
    };

    // Test network connection
    async function testNetworkConnection() {
        try {
            showLoading();
            
            // Create Binance API instance without auth for public API
            const binanceApi = new BinanceAPI();
            
            // Test connectivity
            const isConnected = await binanceApi.testConnectivity();
            
            // Update network status in UI
            updateNetworkStatus(isConnected);
            
            // Update state
            state.botStats.networkStatus.isOnline = isConnected;
            state.botStats.networkStatus.lastChecked = new Date();
            state.botStats.networkStatus.failCount = 0;
            
            if (isConnected) {
                addLogMessage('Network connection successful');
            } else {
                addLogMessage('Network connection test failed', true);
            }
            
            return isConnected;
        } catch (error) {
            console.error('Network connection test error:', error);
            addLogMessage('Network error: ' + error.message, true);
            
            // Update network status in UI
            updateNetworkStatus(false);
            
            // Update state
            state.botStats.networkStatus.isOnline = false;
            state.botStats.networkStatus.lastChecked = new Date();
            state.botStats.networkStatus.failCount++;
            
            return false;
        } finally {
            hideLoading();
        }
    }

    // Update network status in UI
    function updateNetworkStatus(isOnline) {
        const networkStatus = document.getElementById('network-status');
        if (!networkStatus) return;
        
        if (isOnline) {
            networkStatus.className = 'network-status online';
            networkStatus.innerHTML = `
                <div class="network-status-dot online"></div>
                <span>Network: Online</span>
                <button class="btn btn-sm btn-outline-secondary ms-auto test-connection-btn" id="test-connection-btn">
                    Test
                </button>
            `;
        } else {
            networkStatus.className = 'network-status offline';
            networkStatus.innerHTML = `
                <div class="network-status-dot offline"></div>
                <span>Network: Offline</span>
                <button class="btn btn-sm btn-outline-secondary ms-auto test-connection-btn" id="test-connection-btn">
                    Test
                </button>
            `;
        }
        
        // Re-attach event listener
        document.getElementById('test-connection-btn').addEventListener('click', testNetworkConnection);
    }

    // Initialize after successful login
    function initializeAfterLogin() {
        // Set the current date/time
        const clockDisplay = document.getElementById('clock-display');
        if (clockDisplay) clockDisplay.textContent = CURRENT_UTC_DATETIME + ' UTC';
        
        // Set the username
        const userLogin = document.getElementById('user-login');
        if (userLogin) userLogin.textContent = CURRENT_USER;
        
        // Add log message
        addLogMessage('Session started');
        
        // Load settings from storage
        loadSettingsFromStorage();
        
        // Initialize UI components
        initializeUI();
        
        // Test network connection
        testNetworkConnection().then(isConnected => {
            if (isConnected) {
                // Load user progress
                loadUserProgress();
                
                // Fetch initial data
                fetchInitialData();
            } else {
                addLogMessage('Network connection failed. Please check your internet connection and try again.', true);
            }
        });
    }

    // Initialize UI components
    function initializeUI() {
        // Set up Discord toggle behavior
        const discordAlertToggle = document.getElementById('discord-alert-toggle');
        const discordSettings = document.getElementById('discord-settings');
        
        if (discordAlertToggle && discordSettings) {
            discordAlertToggle.addEventListener('change', function() {
                state.alerts.discord.enabled = this.checked;
                discordSettings.style.display = this.checked ? 'block' : 'none';
            });
            
            // Set initial state
            discordSettings.style.display = state.alerts.discord.enabled ? 'block' : 'none';
        }
        
        // Set up Test Discord button
        const testDiscordBtn = document.getElementById('test-discord-btn');
        if (testDiscordBtn) {
            testDiscordBtn.addEventListener('click', async function() {
                // Get the current webhook URL from the input
                const webhookInput = document.getElementById('discord-webhook-input');
                if (webhookInput && webhookInput.value) {
                    state.alerts.discord.webhook = webhookInput.value;
                    
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                    
                    const success = await DiscordNotifier.sendTestMessage();
                    
                    this.disabled = false;
                    if (success) {
                        this.innerHTML = '<i class="fas fa-check"></i> Sent Successfully';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-paper-plane"></i> Send Test Message';
                        }, 3000);
                        addLogMessage('Discord test message sent successfully');
                    } else {
                        this.innerHTML = '<i class="fas fa-times"></i> Failed';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-paper-plane"></i> Send Test Message';
                        }, 3000);
                    }
                } else {
                    addLogMessage('Please enter a Discord webhook URL first', true);
                }
            });
        }
        
        // Set up event listeners
        setupEventListeners();
        
        // Initialize auto-save
        initAutoSave();
        
        // Load settings into UI
        loadSettings();
    }

    // Fetch initial data
    async function fetchInitialData() {
        try {
            showLoading();
            
            // Create Binance API instance for paper trading (public API)
            const binanceApi = new BinanceAPI();
            
            try {
                // Fetch historical price data
                state.priceData = await binanceApi.getHistoricalData(state.symbol, state.timeframe, 100);
                
                if (state.priceData.length > 0) {
                    // Set current price
                    state.currentPrice = state.priceData[state.priceData.length - 1].close;
                    state.botStats.marketData.price = state.currentPrice;
                    
                    // Fetch 24h change and volume
                    try {
                        const ticker = await binanceApi.get24hrTicker(state.symbol);
                        state.botStats.marketData.change24h = ticker.priceChangePercent;
                        state.botStats.marketData.volume = ticker.quoteVolume;
                    } catch (error) {
                        console.error('Error fetching 24h ticker data:', error);
                        addLogMessage('Error fetching market data: ' + error.message, true);
                        // Set default values
                        state.botStats.marketData.change24h = 0;
                        state.botStats.marketData.volume = 0;
                    }
                    
                    // Update market data display
                    updateMarketData();
                    
                    // Calculate indicators
                    const strategy = new VoltyStrategy(state.atrLength, state.atrMultiplier);
                    state.indicators = strategy.generateSignals(state.priceData);
                    
                    // Initialize charts
                    initCharts();
                    
                    // Update price chart
                    updatePriceChart();
                    
                    // Log success
                    addLogMessage(`Loaded ${state.priceData.length} historical candles for ${state.symbol}`);
                } else {
                    addLogMessage('No price data received from Binance API', true);
                }
            } catch (error) {
                console.error('Error fetching historical data:', error);
                addLogMessage('Error fetching historical data: ' + error.message, true);
            }
            
            // Check if we have API keys for real money mode
            if (state.realMoney.apiKey && state.realMoney.apiSecret) {
                try {
                    // Test API keys
                    await testApiKeys(state.realMoney.apiKey, state.realMoney.apiSecret);
                } catch (error) {
                    console.error('Error testing API keys:', error);
                    addLogMessage('Error testing API keys: ' + error.message, true);
                }
            }
            
            // Update UI
            updateMetrics();
            updateTradeHistory();
            updatePositionCard();
            
        } catch (error) {
            console.error('Error initializing data:', error);
            addLogMessage('Error initializing data: ' + error.message, true);
        } finally {
            hideLoading();
        }
    }

    // Setup event listeners
    function setupEventListeners() {
        // Network test button
        const testConnectionBtn = document.getElementById('test-connection-btn');
        if (testConnectionBtn) {
            testConnectionBtn.addEventListener('click', testNetworkConnection);
        }
        
        // Start trading button
        const startTradingBtn = document.getElementById('start-trading-btn');
        if (startTradingBtn) {
            startTradingBtn.addEventListener('click', startTrading);
        }
        
        // Stop trading button
        const stopTradingBtn = document.getElementById('stop-trading-btn');
        if (stopTradingBtn) {
            stopTradingBtn.addEventListener('click', stopTrading);
        }
        
            resetTradingBtn.addEventListener('click', resetTrading);
        }
        
        // Clear log button
        const clearLogBtn = document.getElementById('clear-log-btn');
        if (clearLogBtn) {
            clearLogBtn.addEventListener('click', clearLogs);
        }
        
        // Trading mode switch
        const paperTradingIcon = document.getElementById('paper-trading-icon');
        if (paperTradingIcon) {
            paperTradingIcon.addEventListener('click', switchToPaperTrading);
        }
        
        const realTradingIcon = document.getElementById('real-trading-icon');
        if (realTradingIcon) {
            realTradingIcon.addEventListener('click', switchToRealMoney);
        }
        
        // Emergency sell button
        const emergencySellBtn = document.getElementById('emergency-sell-btn');
        if (emergencySellBtn) {
            emergencySellBtn.addEventListener('click', function() {
                if (confirm('WARNING: This will immediately SELL all current positions. Continue?')) {
                    emergencySell();
                }
            });
        }
        
        // API key management
        const saveApiKeysBtn = document.getElementById('save-api-keys-btn');
        if (saveApiKeysBtn) {
            saveApiKeysBtn.addEventListener('click', saveApiKeys);
        }
        
        // API key visibility toggles
        const showApiKeyBtn = document.getElementById('show-api-key-btn');
        if (showApiKeyBtn) {
            showApiKeyBtn.addEventListener('click', function() {
                toggleFieldVisibility('api-key', this);
            });
        }
        
        const showApiSecretBtn = document.getElementById('show-api-secret-btn');
        if (showApiSecretBtn) {
            showApiSecretBtn.addEventListener('click', function() {
                toggleFieldVisibility('api-secret', this);
            });
        }
        
        // Take profit and stop loss toggles
        const takeProfitToggle = document.getElementById('take-profit-toggle');
        const takeProfitValue = document.getElementById('take-profit-value');
        if (takeProfitToggle && takeProfitValue) {
            takeProfitToggle.addEventListener('change', function() {
                state.settings.takeProfit.enabled = this.checked;
                takeProfitValue.disabled = !this.checked;
            });
        }
        
        const stopLossToggle = document.getElementById('stop-loss-toggle');
        const stopLossValue = document.getElementById('stop-loss-value');
        if (stopLossToggle && stopLossValue) {
            stopLossToggle.addEventListener('change', function() {
                state.settings.stopLoss.enabled = this.checked;
                stopLossValue.disabled = !this.checked;
            });
        }
        
        // Strategy parameter sliders
        const atrLengthSlider = document.getElementById('atr-length');
        const atrLengthValue = document.getElementById('atr-length-value');
        if (atrLengthSlider && atrLengthValue) {
            atrLengthSlider.addEventListener('input', function() {
                atrLengthValue.textContent = this.value;
                state.atrLength = parseInt(this.value);
            });
        }
        
        const atrMultSlider = document.getElementById('atr-mult');
        const atrMultValue = document.getElementById('atr-mult-value');
        if (atrMultSlider && atrMultValue) {
            atrMultSlider.addEventListener('input', function() {
                atrMultValue.textContent = this.value;
                state.atrMultiplier = parseFloat(this.value);
            });
        }
        
        // Position size slider
        const positionSizeSlider = document.getElementById('position-size');
        const positionSizeValue = document.getElementById('position-size-value');
        if (positionSizeSlider && positionSizeValue) {
            positionSizeSlider.addEventListener('input', function() {
                positionSizeValue.textContent = this.value + '%';
                state.positionSize = parseInt(this.value) / 100;
            });
        }
        
        // Chart auto-scroll toggle
        const autoScrollToggle = document.getElementById('auto-scroll-toggle');
        if (autoScrollToggle) {
            autoScrollToggle.addEventListener('change', function() {
                state.settings.chart.autoScroll = this.checked;
            });
        }
        
        // Chart controls
        const refreshChartBtn = document.getElementById('refresh-chart-btn');
        if (refreshChartBtn) {
            refreshChartBtn.addEventListener('click', function() {
                updatePriceChart();
                updateEquityChart();
            });
        }
        
        // Chart zoom controls
        const chartZoomIn = document.getElementById('chart-zoom-in');
        if (chartZoomIn) {
            chartZoomIn.addEventListener('click', function() {
                const layout = document.getElementById('priceChart')._fullLayout;
                const xRange = layout.xaxis.range;
                
                // Zoom in by 25%
                const center = (xRange[0] + xRange[1]) / 2;
                const range = xRange[1] - xRange[0];
                const newRange = range * 0.75;
                const newXRange = [center - newRange/2, center + newRange/2];
                
                Plotly.relayout('priceChart', {'xaxis.range': newXRange});
            });
        }
        
        const chartZoomOut = document.getElementById('chart-zoom-out');
        if (chartZoomOut) {
            chartZoomOut.addEventListener('click', function() {
                const layout = document.getElementById('priceChart')._fullLayout;
                const xRange = layout.xaxis.range;
                
                // Zoom out by 33%
                const center = (xRange[0] + xRange[1]) / 2;
                const range = xRange[1] - xRange[0];
                const newRange = range * 1.33;
                const newXRange = [center - newRange/2, center + newRange/2];
                
                Plotly.relayout('priceChart', {'xaxis.range': newXRange});
            });
        }
        
        const chartReset = document.getElementById('chart-reset');
        if (chartReset) {
            chartReset.addEventListener('click', function() {
                Plotly.relayout('priceChart', {
                    'xaxis.autorange': true,
                    'yaxis.autorange': true
                });
            });
        }
        
        // Export buttons
        const exportTradesBtn = document.getElementById('export-trades-btn');
        if (exportTradesBtn) {
            exportTradesBtn.addEventListener('click', function() {
                exportTrades();
            });
        }
        
        const exportLogsBtn = document.getElementById('export-logs-btn');
        if (exportLogsBtn) {
            exportLogsBtn.addEventListener('click', function() {
                exportLogs();
            });
        }
        
        // Risk management toggle
        const riskManagementToggle = document.getElementById('risk-management-toggle');
        const maxDrawdownValue = document.getElementById('max-drawdown-value');
        const maxDailyLossValue = document.getElementById('max-daily-loss-value');
        
        if (riskManagementToggle && maxDrawdownValue && maxDailyLossValue) {
            riskManagementToggle.addEventListener('change', function() {
                state.settings.riskManagement.enabled = this.checked;
                maxDrawdownValue.disabled = !this.checked;
                maxDailyLossValue.disabled = !this.checked;
            });
        }
        
        // Trailing stop toggle
        const trailingStopToggle = document.getElementById('trailing-stop-toggle');
        const trailingStopValue = document.getElementById('trailing-stop-value');
        
        if (trailingStopToggle && trailingStopValue) {
            trailingStopToggle.addEventListener('change', function() {
                state.settings.trailingStop.enabled = this.checked;
                trailingStopValue.disabled = !this.checked;
            });
        }
        
        // Save all settings button
        const saveAllSettingsBtn = document.getElementById('save-all-settings-btn');
        if (saveAllSettingsBtn) {
            saveAllSettingsBtn.addEventListener('click', function() {
                saveAllSettings();
            });
        }
        
        // Logout button
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to log out?')) {
                    loginSystem.logout();
                }
            });
        }
        
        // Symbol change
        const symbolSelect = document.getElementById('symbol');
        if (symbolSelect) {
            symbolSelect.addEventListener('change', function() {
                state.symbol = this.value;
                if (state.botStats.networkStatus.isOnline) {
                    fetchInitialData();
                }
            });
        }
        
        // Timeframe change
        const timeframeSelect = document.getElementById('timeframe');
        if (timeframeSelect) {
            timeframeSelect.addEventListener('change', function() {
                state.timeframe = this.value;
                if (state.botStats.networkStatus.isOnline) {
                    fetchInitialData();
                }
            });
        }
    }

    // Toggle field visibility (password/text)
    function toggleFieldVisibility(fieldId, button) {
        const field = document.getElementById(fieldId);
        const icon = button.querySelector('i');
        
        if (field.type === 'password') {
            field.type = 'text';
            icon.className = 'fas fa-eye-slash';
        } else {
            field.type = 'password';
            icon.className = 'fas fa-eye';
        }
    }

    // Export trades
    function exportTrades() {
        try {
            // Format the trades for export
            const formattedTrades = state.trades.map((trade, index) => ({
                id: index + 1,
                entryTime: new Date(trade.entryTime).toISOString(),
                exitTime: trade.exitTime ? new Date(trade.exitTime).toISOString() : null,
                type: trade.type,
                entryPrice: trade.entryPrice,
                exitPrice: trade.exitPrice,
                size: trade.size,
                pnl: trade.pnl,
                pnlPct: trade.pnlPct,
                isRealMoney: trade.isRealMoney,
                orderId: trade.orderId
            }));
            
            // Create JSON blob
            const jsonData = JSON.stringify(formattedTrades, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            
            // Create download link
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `volty_trades_${new Date().toISOString().split('T')[0]}.json`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addLogMessage('Trades exported successfully');
            return true;
        } catch (error) {
            console.error('Error exporting trades:', error);
            addLogMessage('Error exporting trades: ' + error.message, true);
            return false;
        }
    }

    // Export logs
    function exportLogs() {
        try {
            // Format the logs for export
            const formattedLogs = state.logs.map(log => ({
                timestamp: log.timestamp,
                message: log.message,
                isError: log.isError
            }));
            
            // Create JSON blob
            const jsonData = JSON.stringify(formattedLogs, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            
            // Create download link
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `volty_logs_${new Date().toISOString().split('T')[0]}.json`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addLogMessage('Logs exported successfully');
            return true;
        } catch (error) {
            console.error('Error exporting logs:', error);
            addLogMessage('Error exporting logs: ' + error.message, true);
            return false;
        }
    }

    // Save API keys
    function saveApiKeys() {
        const apiKeyInput = document.getElementById('api-key');
        const apiSecretInput = document.getElementById('api-secret');
        
        if (!apiKeyInput || !apiSecretInput) {
            addLogMessage('API key input fields not found', true);
            return;
        }
        
        const apiKey = apiKeyInput.value.trim();
        const apiSecret = apiSecretInput.value.trim();
        
        if (!apiKey || !apiSecret) {
            addLogMessage('API key and secret are required', true);
            return;
        }
        
        // Update state
        state.realMoney.apiKey = apiKey;
        state.realMoney.apiSecret = apiSecret;
        
        // Test the API keys
        testApiKeys(apiKey, apiSecret);
    }

    // Test API keys
    async function testApiKeys(apiKey, apiSecret) {
        try {
            showLoading();
            
            const binanceApi = new BinanceAPI(apiKey, apiSecret);
            const isConnected = await binanceApi.testConnectivity();
            
            if (isConnected) {
                // Test account info
                const accountInfo = await binanceApi.getAccountInfo();
                
                // Update state
                state.realMoney.apiKeyValid = true;
                
                // Update UI
                const apiKeyStatus = document.getElementById('api-key-status');
                
                if (apiKeyStatus) {
                    apiKeyStatus.className = 'api-key-status valid';
                    apiKeyStatus.innerHTML = '<i class="fas fa-check-circle"></i> <span id="api-key-status-text">Valid</span>';
                }
                
                // Update account balance
                await updateAccountBalance();
                
                // Log success
                addLogMessage('API keys validated successfully');
            } else {
                throw new Error('API connection test failed');
            }
        } catch (error) {
            console.error('Error testing API keys:', error);
            
            // Update state
            state.realMoney.apiKeyValid = false;
            
            // Update UI
            const apiKeyStatus = document.getElementById('api-key-status');
            
            if (apiKeyStatus) {
                apiKeyStatus.className = 'api-key-status invalid';
                apiKeyStatus.innerHTML = '<i class="fas fa-times-circle"></i> <span id="api-key-status-text">Invalid</span>';
            }
            
            // Log error
            addLogMessage('API key validation failed: ' + error.message, true);
        } finally {
            hideLoading();
        }
    }

    // Update account balance (for real money trading)
    async function updateAccountBalance() {
        if (!state.realMoney.enabled || !state.realMoney.apiKeyValid) {
            return;
        }
        
        try {
            const binanceApi = new BinanceAPI(state.realMoney.apiKey, state.realMoney.apiSecret);
            const balances = await binanceApi.getBalance();
            
            // Update state with balance information
            if (balances.USDT) {
                state.realMoney.balance.USDT = balances.USDT.free + balances.USDT.locked;
            }
            
            if (balances.BTC) {
                state.realMoney.balance.BTC = balances.BTC.free + balances.BTC.locked;
            }
            
            // Calculate total value in USD
            const btcPrice = state.currentPrice;
            const totalValue = state.realMoney.balance.USDT + (state.realMoney.balance.BTC * btcPrice);
            state.realMoney.balance.totalValue = totalValue;
            
            // Update UI
            updateBalanceDisplay();
        } catch (error) {
            console.error('Error updating account balance:', error);
            addLogMessage('Error updating account balance: ' + error.message, true);
        }
    }

    // Update balance display in UI
    function updateBalanceDisplay() {
        const usdtBalance = document.getElementById('usdt-balance');
        const btcBalance = document.getElementById('btc-balance');
        const totalBalance = document.getElementById('total-balance');
        
        if (usdtBalance) usdtBalance.textContent = state.realMoney.balance.USDT.toFixed(2);
        if (btcBalance) btcBalance.textContent = state.realMoney.balance.BTC.toFixed(8);
        if (totalBalance) totalBalance.textContent = '$' + state.realMoney.balance.totalValue.toFixed(2);
    }

    // Switch to real money trading mode
    function switchToRealMoney() {
        if (state.realMoney.enabled) {
            addLogMessage('Already in real money mode', true);
            return;
        }
        
        // Confirm the switch
        if (!confirm('WARNING: You are about to switch to REAL MONEY trading mode. This will use real funds. Are you sure?')) {
            return;
        }
        
        // Double confirm for safety
        if (!confirm('FINAL WARNING: Real money trading can result in financial loss. Do you accept the risk?')) {
            return;
        }
        
        // Update state
        state.realMoney.enabled = true;
        
        // Update UI
        updateTradingMode();
        
        // Show real money sections
        const realMoneyElements = [
            'api-key-section', 'real-money-warning', 'balance-section', 
            'real-trading-settings'
        ];
        
        realMoneyElements.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'block';
        });
        
        // Hide paper trading sections
        const paperElement = document.getElementById('paper-trading-settings');
        if (paperElement) paperElement.style.display = 'none';
        
        // Update mode icons
        const paperIcon = document.querySelector('.mode-icon.paper');
        const realIcon = document.querySelector('.mode-icon.real');
        
        if (paperIcon) paperIcon.classList.remove('active');
        if (realIcon) realIcon.classList.add('active');
        
        // Update bot status
        updateBotStatus('idle', 'Switched to REAL MONEY mode');
        
        // Log the change
        addLogMessage('Switched to REAL MONEY trading mode');
    }

    // Switch to paper trading mode
    function switchToPaperTrading() {
        if (!state.realMoney.enabled) {
            addLogMessage('Already in paper trading mode', true);
            return;
        }
        
        // Update state
        state.realMoney.enabled = false;
        
        // Update UI
        updateTradingMode();
        
        // Hide real money sections
        const realMoneyElements = [
            'api-key-section', 'real-money-warning', 'balance-section', 
            'real-trading-settings'
        ];
        
        realMoneyElements.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'none';
        });
        
        // Show paper trading sections
        const paperElement = document.getElementById('paper-trading-settings');
        if (paperElement) paperElement.style.display = 'block';
        
        // Update mode icons
        const paperIcon = document.querySelector('.mode-icon.paper');
        const realIcon = document.querySelector('.mode-icon.real');
        
        if (paperIcon) paperIcon.classList.add('active');
        if (realIcon) realIcon.classList.remove('active');
        
        // Update bot status
        updateBotStatus('idle', 'Switched to paper trading mode');
        
        // Log the change
        addLogMessage('Switched to paper trading mode');
    }

    // Update trading mode in the UI
    function updateTradingMode() {
        const botStatus = document.getElementById('bot-status');
        
        if (botStatus) {
            if (state.realMoney.enabled) {
                botStatus.textContent = '💰 REAL MONEY TRADING';
                botStatus.className = 'status-indicator real-money';
            } else {
                botStatus.textContent = '🔴 PAPER TRADING';
                botStatus.className = 'status-indicator live';
            }
        }
    }

    // Emergency sell all positions
    function emergencySell() {
        if (state.currentPosition) {
            exitPosition('Emergency Sell');
            addLogMessage('EMERGENCY SELL executed - Position closed', true);
        } else {
            addLogMessage('No open position to sell', true);
        }
    }

    // Save all settings
    function saveAllSettings() {
        try {
            // Get values from all settings inputs
            // Risk management
            const riskManagementToggle = document.getElementById('risk-management-toggle');
            const maxDrawdownValue = document.getElementById('max-drawdown-value');
            const maxDailyLossValue = document.getElementById('max-daily-loss-value');
            
            if (riskManagementToggle && maxDrawdownValue && maxDailyLossValue) {
                state.settings.riskManagement.enabled = riskManagementToggle.checked;
                state.settings.riskManagement.maxDrawdown = parseFloat(maxDrawdownValue.value);
                state.settings.riskManagement.maxDailyLoss = parseFloat(maxDailyLossValue.value);
            }
            
            // Trailing stop
            const trailingStopToggle = document.getElementById('trailing-stop-toggle');
            const trailingStopValue = document.getElementById('trailing-stop-value');
            
            if (trailingStopToggle && trailingStopValue) {
                state.settings.trailingStop.enabled = trailingStopToggle.checked;
                state.settings.trailingStop.percentage = parseFloat(trailingStopValue.value);
            }
            
            // Chart settings
            const chartTypeSelect = document.getElementById('chart-type');
            const showVolumeToggle = document.getElementById('show-volume-toggle');
            const showIndicatorsToggle = document.getElementById('show-indicators-toggle');
            
            if (chartTypeSelect) {
                state.settings.chart.type = chartTypeSelect.value;
            }
            
            if (showVolumeToggle) {
                state.settings.chart.showVolume = showVolumeToggle.checked;
            }
            
            if (showIndicatorsToggle) {
                state.settings.chart.showIndicators = showIndicatorsToggle.checked;
            }
            
            // Network settings
            const retryAttemptsInput = document.getElementById('retry-attempts');
            const timeoutSecondsInput = document.getElementById('timeout-seconds');
            const fallbackApiToggle = document.getElementById('fallback-api-toggle');
            
            if (retryAttemptsInput) {
                state.settings.network.retryAttempts = parseInt(retryAttemptsInput.value);
            }
            
            if (timeoutSecondsInput) {
                state.settings.network.timeoutSeconds = parseInt(timeoutSecondsInput.value);
            }
            
            if (fallbackApiToggle) {
                state.settings.network.usePublicApiFallback = fallbackApiToggle.checked;
            }
            
            // Alert settings
            const browserAlertToggle = document.getElementById('browser-alert-toggle');
            const soundAlertToggle = document.getElementById('sound-alert-toggle');
            const soundVolumeInput = document.getElementById('sound-volume-input');
            
            if (browserAlertToggle) {
                state.alerts.browser.enabled = browserAlertToggle.checked;
            }
            
            if (soundAlertToggle && soundVolumeInput) {
                state.alerts.sound.enabled = soundAlertToggle.checked;
                state.alerts.sound.volume = parseFloat(soundVolumeInput.value);
            }
            
            // Discord settings
            const discordAlertToggle = document.getElementById('discord-alert-toggle');
            const discordWebhookInput = document.getElementById('discord-webhook-input');
            const discordIncludeChart = document.getElementById('discord-include-chart');
            const discordIncludeMetrics = document.getElementById('discord-include-metrics');
            const discordTradeAlerts = document.getElementById('discord-trade-alerts');
            
            if (discordAlertToggle && discordWebhookInput) {
                state.alerts.discord.enabled = discordAlertToggle.checked;
                state.alerts.discord.webhook = discordWebhookInput.value;
            }
            
            if (discordIncludeChart) {
                state.alerts.discord.includeChart = discordIncludeChart.checked;
            }
            
            if (discordIncludeMetrics) {
                state.alerts.discord.includeMetrics = discordIncludeMetrics.checked;
            }
            
            if (discordTradeAlerts) {
                state.alerts.discord.includeTrades = discordTradeAlerts.checked;
            }
            
            // Auto trade setting
            const autoTradeToggle = document.getElementById('auto-trade-toggle');
            if (autoTradeToggle) {
                state.settings.autoTrade = autoTradeToggle.checked;
            }
            
            // Theme setting
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                state.settings.theme = themeSelect.value;
                
                // Apply theme
                if (state.settings.theme === 'light') {
                    document.body.classList.add('light-theme');
                    document.body.classList.remove('dark-theme');
                } else {
                    document.body.classList.add('dark-theme');
                    document.body.classList.remove('light-theme');
                }
            }
            
            // Chart update frequency
            const chartUpdateFrequency = document.getElementById('chart-update-frequency');
            if (chartUpdateFrequency) {
                state.settings.chartUpdateFrequency = parseInt(chartUpdateFrequency.value) * 1000;
                
                // If trading is active, restart the interval
                if (state.isTrading) {
                    clearInterval(state.interval);
                    state.interval = setInterval(tradingLoop, state.settings.chartUpdateFrequency);
                }
            }
            
            // Save settings to localStorage
            localStorage.setItem('voltyBotSettings', JSON.stringify({
                settings: state.settings,
                alerts: state.alerts,
                realMoney: {
                    orderType: state.realMoney.orderType,
                    tradeAmount: state.realMoney.tradeAmount,
                    maxDailyLoss: state.realMoney.maxDailyLoss
                }
            }));
            
            // Apply settings
            updatePriceChart();
            
            // Log success
            addLogMessage('All settings saved successfully');
        } catch (error) {
            console.error('Error saving settings:', error);
            addLogMessage('Error saving settings: ' + error.message, true);
        }
    }

    // Load settings from localStorage
    function loadSettingsFromStorage() {
        try {
            const savedSettings = localStorage.getItem('voltyBotSettings');
            
            if (savedSettings) {
                const parsedSettings = JSON.parse(savedSettings);
                
                // Merge settings with defaults
                if (parsedSettings.settings) {
                    state.settings = { ...state.settings, ...parsedSettings.settings };
                }
                
                if (parsedSettings.alerts) {
                    state.alerts = { ...state.alerts, ...parsedSettings.alerts };
                }
                
                if (parsedSettings.realMoney) {
                    Object.assign(state.realMoney, parsedSettings.realMoney);
                }
                
                // Apply theme
                if (state.settings.theme === 'light') {
                    document.body.classList.add('light-theme');
                    document.body.classList.remove('dark-theme');
                } else {
                    document.body.classList.add('dark-theme');
                    document.body.classList.remove('light-theme');
                }
                
                addLogMessage('Settings loaded from storage');
                return true;
            }
        } catch (error) {
            console.error('Error loading settings:', error);
            addLogMessage('Error loading settings: ' + error.message, true);
        }
        
        return false;
    }

    // Load settings into the UI
    function loadSettings() {
        // Risk management settings
        const riskManagementToggle = document.getElementById('risk-management-toggle');
        const maxDrawdownValue = document.getElementById('max-drawdown-value');
        const maxDailyLossValue = document.getElementById('max-daily-loss-value');
        
        if (riskManagementToggle) riskManagementToggle.checked = state.settings.riskManagement.enabled;
        if (maxDrawdownValue) {
            maxDrawdownValue.value = state.settings.riskManagement.maxDrawdown;
            maxDrawdownValue.disabled = !state.settings.riskManagement.enabled;
        }
        if (maxDailyLossValue) {
            maxDailyLossValue.value = state.settings.riskManagement.maxDailyLoss;
            maxDailyLossValue.disabled = !state.settings.riskManagement.enabled;
        }
        
        // Trailing stop
        const trailingStopToggle = document.getElementById('trailing-stop-toggle');
        const trailingStopValue = document.getElementById('trailing-stop-value');
        
        if (trailingStopToggle) trailingStopToggle.checked = state.settings.trailingStop.enabled;
        if (trailingStopValue) {
            trailingStopValue.value = state.settings.trailingStop.percentage;
            trailingStopValue.disabled = !state.settings.trailingStop.enabled;
        }
        
        // Chart settings
        const chartTypeSelect = document.getElementById('chart-type');
        const showVolumeToggle = document.getElementById('show-volume-toggle');
        const showIndicatorsToggle = document.getElementById('show-indicators-toggle');
        
        if (chartTypeSelect) chartTypeSelect.value = state.settings.chart.type || 'candlestick';
        if (showVolumeToggle) showVolumeToggle.checked = state.settings.chart.showVolume !== false;
        if (showIndicatorsToggle) showIndicatorsToggle.checked = state.settings.chart.showIndicators !== false;
        
        // Take profit and stop loss
        const takeProfitToggle = document.getElementById('take-profit-toggle');
        const takeProfitValue = document.getElementById('take-profit-value');
        const stopLossToggle = document.getElementById('stop-loss-toggle');
        const stopLossValue = document.getElementById('stop-loss-value');
        
        if (takeProfitToggle) takeProfitToggle.checked = state.settings.takeProfit.enabled;
        if (takeProfitValue) {
            takeProfitValue.value = state.settings.takeProfit.percentage;
            takeProfitValue.disabled = !state.settings.takeProfit.enabled;
        }
        
        if (stopLossToggle) stopLossToggle.checked = state.settings.stopLoss.enabled;
        if (stopLossValue) {
            stopLossValue.value = state.settings.stopLoss.percentage;
            stopLossValue.disabled = !state.settings.stopLoss.enabled;
        }
        
        // Strategy parameters
        const atrLength = document.getElementById('atr-length');
        const atrLengthValue = document.getElementById('atr-length-value');
        const atrMult = document.getElementById('atr-mult');
        const atrMultValue = document.getElementById('atr-mult-value');
        
        if (atrLength) {
            atrLength.value = state.atrLength;
            if (atrLengthValue) atrLengthValue.textContent = state.atrLength;
        }
        
        if (atrMult) {
            atrMult.value = state.atrMultiplier;
            if (atrMultValue) atrMultValue.textContent = state.atrMultiplier;
        }
        
        // Trading settings
        const initialCapital = document.getElementById('initial-capital');
        const positionSize = document.getElementById('position-size');
        const positionSizeValue = document.getElementById('position-size-value');
        
        if (initialCapital) initialCapital.value = state.initialCapital;
        if (positionSize) {
            positionSize.value = state.positionSize * 100;
            if (positionSizeValue) positionSizeValue.textContent = (state.positionSize * 100) + '%';
        }
        
        // Real money trading settings
        const orderTypeSelect = document.getElementById('order-type');
        const tradeAmountInput = document.getElementById('trade-amount');
        const maxDailyLossInput = document.getElementById('max-daily-loss');
        
        if (orderTypeSelect) orderTypeSelect.value = state.realMoney.orderType;
        if (tradeAmountInput) tradeAmountInput.value = state.realMoney.tradeAmount;
        if (maxDailyLossInput) maxDailyLossInput.value = state.realMoney.maxDailyLoss;
        
        // Theme
        const themeSelect = document.getElementById('theme-select');
        if (themeSelect) themeSelect.value = state.settings.theme;
        
        // Chart update frequency
        const chartUpdateFrequency = document.getElementById('chart-update-frequency');
        if (chartUpdateFrequency) chartUpdateFrequency.value = state.settings.chartUpdateFrequency / 1000;
        
        // Auto trade
        const autoTradeToggle = document.getElementById('auto-trade-toggle');
        if (autoTradeToggle) autoTradeToggle.checked = state.settings.autoTrade;
        
        // Network settings
        const retryAttemptsInput = document.getElementById('retry-attempts');
        const timeoutSecondsInput = document.getElementById('timeout-seconds');
        const fallbackApiToggle = document.getElementById('fallback-api-toggle');
        
        if (retryAttemptsInput) retryAttemptsInput.value = state.settings.network.retryAttempts;
        if (timeoutSecondsInput) timeoutSecondsInput.value = state.settings.network.timeoutSeconds;
        if (fallbackApiToggle) fallbackApiToggle.checked = state.settings.network.usePublicApiFallback;
        
        // Alert settings
        const browserAlertToggle = document.getElementById('browser-alert-toggle');
        const soundAlertToggle = document.getElementById('sound-alert-toggle');
        const soundVolumeInput = document.getElementById('sound-volume-input');
        
        if (browserAlertToggle) browserAlertToggle.checked = state.alerts.browser.enabled;
        if (soundAlertToggle) soundAlertToggle.checked = state.alerts.sound.enabled;
        if (soundVolumeInput) {
            soundVolumeInput.value = state.alerts.sound.volume;
            soundVolumeInput.disabled = !state.alerts.sound.enabled;
        }
        
        // Discord settings
        const discordAlertToggle = document.getElementById('discord-alert-toggle');
        const discordWebhookInput = document.getElementById('discord-webhook-input');
        const discordIncludeChart = document.getElementById('discord-include-chart');
        const discordIncludeMetrics = document.getElementById('discord-include-metrics');
        const discordTradeAlerts = document.getElementById('discord-trade-alerts');
        
        if (discordAlertToggle) discordAlertToggle.checked = state.alerts.discord.enabled;
        if (discordWebhookInput) {
            discordWebhookInput.value = state.alerts.discord.webhook;
            discordWebhookInput.disabled = !state.alerts.discord.enabled;
        }
        
        if (discordIncludeChart) discordIncludeChart.checked = state.alerts.discord.includeChart !== false;
        if (discordIncludeMetrics) discordIncludeMetrics.checked = state.alerts.discord.includeMetrics !== false;
        if (discordTradeAlerts) discordTradeAlerts.checked = state.alerts.discord.includeTrades !== false;
    }

    // Display loading indicator
    function showLoading() {
        const loadingIndicator = document.getElementById('loadingIndicator');
        if (loadingIndicator) loadingIndicator.style.display = 'flex';
    }

    // Hide loading indicator
    function hideLoading() {
        const loadingIndicator = document.getElementById('loadingIndicator');
        if (loadingIndicator) loadingIndicator.style.display = 'none';
    }

    // Update bot status UI
    function updateBotStatus(status, message = '') {
        state.botStats.status = status;
        
        const botStatus = document.getElementById('bot-status');
        const activityStatus = document.getElementById('activity-status');
        
        if (botStatus) {
            switch (status) {
                case 'active':
                    botStatus.textContent = '✅ BOT ACTIVE';
                    botStatus.className = 'status-indicator active';
                    break;
                case 'idle':
                    botStatus.textContent = '⏸️ BOT IDLE';
                    botStatus.className = 'status-indicator idle';
                    break;
                case 'error':
                    botStatus.textContent = '❌ BOT ERROR';
                    botStatus.className = 'status-indicator error';
                    break;
                default:
                    if (state.realMoney.enabled) {
                        botStatus.textContent = '💰 REAL MONEY TRADING';
                        botStatus.className = 'status-indicator real-money';
                    } else {
                        botStatus.textContent = '🔴 PAPER TRADING';
                        botStatus.className = 'status-indicator live';
                    }
            }
        }
        
        if (activityStatus && message) {
            activityStatus.textContent = message;
        }
        
        // Update last tick time
        const now = new Date();
        state.botStats.lastTickTime = now;
        
        const lastTickInfo = document.getElementById('last-tick-info');
        if (lastTickInfo) {
            lastTickInfo.textContent = `Last check: ${now.toLocaleTimeString()}`;
        }
    }

    // Update market data display
    function updateMarketData() {
        const marketPrice = document.getElementById('market-price');
        const changeElement = document.getElementById('market-change');
        const volumeElement = document.getElementById('market-volume');
        
        if (marketPrice) marketPrice.textContent = '$' + state.botStats.marketData.price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        
        if (changeElement) {
            const changeValue = state.botStats.marketData.change24h;
            changeElement.textContent = (changeValue >= 0 ? '+' : '') + changeValue.toFixed(2) + '%';
            changeElement.className = changeValue >= 0 ? 'market-value up' : 'market-value down';
        }
        
        if (volumeElement) volumeElement.textContent = formatLargeNumber(state.botStats.marketData.volume);
    }

    // Initialize charts
    function initCharts() {
        try {
            // Check if Plotly and chart elements exist
            if (!window.Plotly || !document.getElementById('priceChart') || !document.getElementById('equityChart')) {
                console.error('Plotly or chart elements not found');
                return;
            }
            
            if (state.priceData.length === 0) {
                // Display empty charts with placeholder text
                Plotly.newPlot('priceChart', [{
                    x: [new Date()],
                    y: [0],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Price',
                    line: { color: '#3b82f6', width: 2 }
                }], {
                    margin: { l: 50, r: 20, t: 20, b: 30 },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: '#f1f5f9' },
                    xaxis: {
                        gridcolor: 'rgba(255,255,255,0.1)',
                        title: 'Time',
                        tickfont: { color: '#f1f5f9' }
                    },
                    yaxis: {
                        gridcolor: 'rgba(255,255,255,0.1)',
                        title: 'Price ($)',
                        tickfont: { color: '#f1f5f9' }
                    },
                    annotations: [{
                        x: 0.5,
                        y: 0.5,
                        xref: 'paper',
                        yref: 'paper',
                        text: 'No price data available.<br>Connect to Binance API to see data.',
                        showarrow: false,
                        font: { color: '#f1f5f9', size: 14 }
                    }]
                }, { responsive: true });
                
                Plotly.newPlot('equityChart', [{
                    x: [new Date()],
                    y: [state.initialCapital],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Equity',
                    line: { color: '#22c55e', width: 2 }
                }], {
                    margin: { l: 50, r: 20, t: 20, b: 30 },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: '#f1f5f9' },
                    xaxis: {
                        gridcolor: 'rgba(255,255,255,0.1)',
                        title: 'Time',
                        tickfont: { color: '#f1f5f9' }
                    },
                    yaxis: {
                        gridcolor: 'rgba(255,255,255,0.1)',
                        title: 'Equity ($)',
                        tickfont: { color: '#f1f5f9' }
                    },
                    annotations: [{
                        x: 0.5,
                        y: 0.5,
                        xref: 'paper',
                        yref: 'paper',
                        text: 'No equity data available.<br>Make trades to see your equity curve.',
                        showarrow: false,
                        font: { color: '#f1f5f9', size: 14 }
                    }]
                }, { responsive: true });
                
                return;
            }
            
            // Create price chart with available data
            updatePriceChart();
            updateEquityChart();
        } catch (error) {
            console.error('Error initializing charts:', error);
            addLogMessage('Error initializing charts: ' + error.message, true);
        }
    }

    // Update price chart with latest data
    function updatePriceChart() {
        try {
            if (!window.Plotly || !document.getElementById('priceChart') || state.priceData.length === 0) {
                return;
            }
            
            // Extract data for Plotly
            const dates = state.priceData.map(candle => new Date(candle.time));
            const opens = state.priceData.map(candle => candle.open);
            const highs = state.priceData.map(candle => candle.high);
            const lows = state.priceData.map(candle => candle.low);
            const closes = state.priceData.map(candle => candle.close);
            const volumes = state.priceData.map(candle => candle.volume);
            
            // Create colors for volume bars
            const volumeColors = state.priceData.map(candle => candle.close >= candle.open ? OHLC_COLORS.volume.up : OHLC_COLORS.volume.down);
            
            const traces = [];
            
            // Chart type based on settings
            if (state.settings.chart.type === 'candlestick') {
                traces.push({
                    x: dates,
                    open: opens,
                    high: highs,
                    low: lows,
                    close: closes,
                    type: 'candlestick',
                    name: 'Price',
                    increasing: {
                        line: { color: OHLC_COLORS.up },
                        fillcolor: OHLC_COLORS.upFill
                    },
                    decreasing: {
                        line: { color: OHLC_COLORS.down },
                        fillcolor: OHLC_COLORS.downFill
                    }
                });
            } else if (state.settings.chart.type === 'ohlc') {
                traces.push({
                    x: dates,
                    open: opens,
                    high: highs,
                    low: lows,
                    close: closes,
                    type: 'ohlc',
                    name: 'Price',
                    increasing: { line: { color: OHLC_COLORS.up } },
                    decreasing: { line: { color: OHLC_COLORS.down } }
                });
            } else {
                // Default to line chart
                traces.push({
                    x: dates,
                    y: closes,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Price',
                    line: { color: '#3b82f6', width: 2 }
                });
            }
            
            // Add volume if enabled
            if (state.settings.chart.showVolume) {
                traces.push({
                    x: dates,
                    y: volumes,
                    type: 'bar',
                    name: 'Volume',
                    yaxis: 'y2',
                    marker: { color: volumeColors },
                    opacity: 0.5
                });
            }
            
            // Add indicators if enabled
            if (state.settings.chart.showIndicators && state.indicators && state.indicators.longSignal && state.indicators.longSignal.length > 0) {
                // Long signal line
                traces.push({
                    x: dates,
                    y: state.indicators.longSignal,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Long Signal',
                    line: {
                        color: 'rgba(34, 197, 94, 0.8)',
                        width: 1,
                        dash: 'dot'
                    }
                });
                
                // Short signal line
                traces.push({
                    x: dates,
                    y: state.indicators.shortSignal,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Short Signal',
                    line: {
                        color: 'rgba(239, 68, 68, 0.8)',
                        width: 1,
                        dash: 'dot'
                    }
                });
            }
            
            // Add trade markers
            if (state.trades.length > 0) {
                const longEntries = [];
                const longExits = [];
                const shortEntries = [];
                const shortExits = [];
                
                state.trades.forEach(trade => {
                    if (trade.type === 'LONG') {
                        longEntries.push({
                            x: new Date(trade.entryTime),
                            y: trade.entryPrice
                        });
                        
                        if (trade.exitTime) {
                            longExits.push({
                                x: new Date(trade.exitTime),
                                y: trade.exitPrice
                            });
                        }
                    } else {
                        shortEntries.push({
                            x: new Date(trade.entryTime),
                            y: trade.entryPrice
                        });
                        
                        if (trade.exitTime) {
                            shortExits.push({
                                x: new Date(trade.exitTime),
                                y: trade.exitPrice
                            });
                        }
                    }
                });
                
                if (longEntries.length > 0) {
                    traces.push({
                        x: longEntries.map(p => p.x),
                        y: longEntries.map(p => p.y),
                        type: 'scatter',
                        mode: 'markers',
                        name: 'Long Entry',
                        marker: {
                            color: 'rgba(34, 197, 94, 1)',
                            size: 10,
                            symbol: 'triangle-up'
                        }
                    });
                }
                
                if (longExits.length > 0) {
                    traces.push({
                        x: longExits.map(p => p.x),
                        y: longExits.map(p => p.y),
                        type: 'scatter',
                        mode: 'markers',
                        name: 'Long Exit',
                        marker: {
                            color: 'rgba(34, 197, 94, 0.8)',
                            size: 10,
                            symbol: 'circle'
                        }
                    });
                }
                
                if (shortEntries.length > 0) {
                    traces.push({
                        x: shortEntries.map(p => p.x),
                        y: shortEntries.map(p => p.y),
                        type: 'scatter',
                        mode: 'markers',
                        name: 'Short Entry',
                        marker: {
                            color: 'rgba(239, 68, 68, 1)',
                            size: 10,
                            symbol: 'triangle-down'
                        }
                    });
                }
                
                if (shortExits.length > 0) {
                    traces.push({
                        x: shortExits.map(p => p.x),
                        y: shortExits.map(p => p.y),
                        type: 'scatter',
                        mode: 'markers',
                        name: 'Short Exit',
                        marker: {
                            color: 'rgba(239, 68, 68, 0.8)',
                            size: 10,
                            symbol: 'circle'
                        }
                    });
                }
            }
            
            // Update chart layout
            const layout = {
                margin: { l: 50, r: 20, t: 20, b: 30 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: '#f1f5f9'
                },
                xaxis: {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Time',
                    tickfont: {
                        color: '#f1f5f9'
                    }
                },
                yaxis: {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Price ($)',
                    tickfont: {
                        color: '#f1f5f9'
                    },
                    domain: state.settings.chart.showVolume ? [0.2, 1] : [0, 1]
                },
                showlegend: true,
                legend: {
                    x: 0.01,
                    y: 0.99,
                    bgcolor: 'rgba(0,0,0,0.3)',
                    bordercolor: 'rgba(255,255,255,0.2)',
                    borderwidth: 1
                }
            };
            
            // Add volume axis if needed
            if (state.settings.chart.showVolume) {
                layout.yaxis2 = {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Volume',
                    tickfont: {
                        color: '#f1f5f9'
                    },
                    domain: [0, 0.15],
                    showticklabels: false
                };
            }
            
            // Update the chart
            Plotly.newPlot('priceChart', traces, layout, { responsive: true });
            
            // Auto-scroll if enabled
            if (state.settings.chart.autoScroll) {
                const xRange = [
                    dates[Math.max(0, dates.length - 50)],
                    dates[dates.length - 1]
                ];
                
                Plotly.relayout('priceChart', {'xaxis.range': xRange});
            }
        } catch (error) {
            console.error('Error updating price chart:', error);
            addLogMessage('Error updating price chart: ' + error.message, true);
        }
    }

    // Update equity curve chart
    function updateEquityChart() {
        try {
            if (!window.Plotly || !document.getElementById('equityChart')) {
                return;
            }
            
            let equityData = [];
            
            // Add live trading equity
            if (state.equityCurve.length > 0) {
                equityData.push({
                    x: state.equityCurve.map(p => p.time),
                    y: state.equityCurve.map(p => p.value),
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Live Trading',
                    line: {
                        color: '#22c55e',
                        width: 2
                    }
                });
            } else {
                // Just add initial capital point if no trades
                equityData.push({
                    x: [new Date()],
                    y: [state.currentCapital],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Equity',
                    line: {
                        color: '#22c55e',
                        width: 2
                    }
                });
            }
            
            // Update chart layout
            const layout = {
                margin: { l: 50, r: 20, t: 20, b: 30 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    color: '#f1f5f9'
                },
                xaxis: {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Time',
                    tickfont: {
                        color: '#f1f5f9'
                    }
                },
                yaxis: {
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Equity ($)',
                    tickfont: {
                        color: '#f1f5f9'
                    }
                },
                showlegend: true,
                legend: {
                    x: 0.01,
                    y: 0.99,
                    bgcolor: 'rgba(0,0,0,0.3)',
                    bordercolor: 'rgba(255,255,255,0.2)',
                    borderwidth: 1
                }
            };
            
            // Update the chart
            Plotly.newPlot('equityChart', equityData, layout, { responsive: true });
        } catch (error) {
            console.error('Error updating equity chart:', error);
            addLogMessage('Error updating equity chart: ' + error.message, true);
        }
    }

    // Log message function
    function addLogMessage(message, isError = false) {
        // Create timestamp
        const timestamp = new Date().toLocaleString();
        
        // Log to console
        if (isError) {
            console.error(`[${timestamp}] ${message}`);
        } else {
            console.log(`[${timestamp}] ${message}`);
        }
        
        // Store in logs array
        state.logs.push({
            timestamp,
            message,
            isError
        });
        
        // Update UI
        const logElement = document.getElementById('logMessages');
        if (logElement) {
            // Create UI element
            const logItem = document.createElement('div');
            logItem.className = isError ? 'negative' : '';
            logItem.innerHTML = `<strong>${timestamp}</strong>: ${message}`;
            
            // Add to UI (at the top)
            logElement.prepend(logItem);
            
            // Limit the number of log messages in the UI
            while (logElement.childElementCount > 100) {
                logElement.removeChild(logElement.lastChild);
            }
        }
    }

    // Clear logs
    function clearLogs() {
        const logElement = document.getElementById('logMessages');
        if (logElement) {
            logElement.innerHTML = '';
        }
        
        addLogMessage('Logs cleared');
    }

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
        // Set current date/time and username
        state.currentDateTime = '2025-06-07 01:07:52';
        state.currentUser = 'gelimorto2';
        
        // Update the clock display
        const clockDisplay = document.getElementById('clock-display');
        if (clockDisplay) clockDisplay.textContent = state.currentDateTime + ' UTC';
        
        // Initialize login system
        loginSystem.init();
    });
    </script>
</body>
</html>
